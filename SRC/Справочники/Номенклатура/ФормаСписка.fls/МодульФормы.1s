////////////////////////////////////////////////////////////////////////////////
// ѕ≈–≈ћ≈ЌЌџ≈ ћќƒ”Ћя
// 
ѕерем “аблицаѕеч‘орм;
ѕерем Ќомер“екущей‘ормы;
ѕерем ‘орма—писка÷ен;
ѕерем Ќ—,–ег1, –ег2, —клад_темп, “«, “«2;	//–абота с остатками

ѕерем ‘орма“аблицыќстатков;  // контекст формы с таблицей остатков
ѕерем —клад;

ѕроцедура ѕри»зменениифл—крывать»з¬осьмерки() ƒалее
   
‘ункци€ ѕолучить√руппуЌоменклатуры()   

	“екЌоменклатура = “екущийЁлемент();
	¬озврат глѕолучить√руппуЌоменклатуры(“екЌоменклатура, —клад);
	 
 онец‘ункции

////////////////////////////////////////////////////////////////////////////////
// ѕ–ќ÷≈ƒ”–џ » ‘”Ќ ÷»» ћќƒ”Ћя
//
//******************************************************************************
// —формироватьЎтрихкод(¬есовой,  од)
//
// ѕараметры:
//  ¬есовой - 1 - позици€ номенклатуры €вл€етс€ весовым товаром
//            0 - позици€ номенклатуры €вл€етс€ штучным товаром
//   од     - код позиции номенклатуры, дл€ которой формируетс€ штрих-код
//
// ¬озвращаемое значение:
//  строка - сформированный штрихкод
//
// ќписание:
//  ‘ормирует уникальный штрихкод позиции номенклатуры 
//
‘ункци€ —формироватьЎтрихкод(¬есовой,  од)
	
	—пр≈диницы = —оздатьќбъект("—правочник.≈диницы");
	—формировали”никальныйЎтрихкод = 0;
	
	≈сли ¬есовой = 0 “огда
		
		// —формируем штрих-код штучного товара
		
		 од“овара = глƒополнить—трокуЋ(„исло(—окрЋ(ѕрав( од, 6))), "0", 7);
		
		ƒл€ —ч = 1 ѕо 999 ÷икл
			
			ƒоп од = глƒополнить—трокуЋ(—трока(—ч), "0", 3);
			¬ремЎтрихкод = гл—формироватьЎтрихкод(глѕрефиксЎтучногоЎтрихкода,  од“овара + ƒоп од);
			
			≈сли —пр≈диницы.Ќайтиѕо–еквизиту("Ўтрихкод", ¬ремЎтрихкод, 1) = 0 “огда
				—формировали”никальныйЎтрихкод = 1;
				ѕрервать;
			 онец≈сли;
		 онец÷икла;
		
		≈сли —формировали”никальныйЎтрихкод = 0 “огда
			
			// —формируем штрих-код независимо от кода номенклатуры
			
			ƒл€ —ч = 1 ѕо 9999999999 ÷икл // 10 разр€дов
				
				ƒоп од = глƒополнить—трокуЋ(—трока(—ч), "0", 10);
				¬ремЎтрихкод = гл—формироватьЎтрихкод(глѕрефиксЎтучногоЎтрихкода, ƒоп од);
				
				≈сли —пр≈диницы.Ќайтиѕо–еквизиту("Ўтрихкод", ¬ремЎтрихкод, 1) = 0 “огда
					—формировали”никальныйЎтрихкод = 1;
					ѕрервать;
				 онец≈сли;
			 онец÷икла;
		 онец≈сли;
		
	»наче
		
		// —формируем штрих-код весового товара
		
		 од“овара„исло = „исло(—окрЋ(ѕрав( од, 5)));
		
		ƒл€ —ч =  од“овара„исло ѕо 99999 ÷икл // 5 разр€дов
			
			ƒоп од = глƒополнить—трокуЋ(—трока(—ч), "0", 5);
			¬ремЎтрихкод = гл—формироватьЎтрихкод(глѕрефикс¬есовогоЎтрихкода, ƒоп од + "00000");
			
			≈сли —пр≈диницы.Ќайтиѕо–еквизиту("Ўтрихкод", ¬ремЎтрихкод, 1) = 0 “огда
				—формировали”никальныйЎтрихкод = 1;
				ѕрервать;
			 онец≈сли;
		 онец÷икла;
		
		≈сли —формировали”никальныйЎтрихкод = 0 “огда
			ƒл€ —ч = 1 ѕо  од“овара„исло ÷икл
				
				ƒоп од = глƒополнить—трокуЋ(—трока(—ч), "0", 5);
				¬ремЎтрихкод = гл—формироватьЎтрихкод(глѕрефикс¬есовогоЎтрихкода, ƒоп од + "00000");
				
				≈сли —пр≈диницы.Ќайтиѕо–еквизиту("Ўтрихкод", ¬ремЎтрихкод, 1) = 0 “огда
					—формировали”никальныйЎтрихкод = 1;
					ѕрервать;
				 онец≈сли;
			 онец÷икла;
		 онец≈сли;
	    
	 онец≈сли; // ≈сли ¬есовой = 0 “огда
	
	≈сли —формировали”никальныйЎтрихкод = 0 “огда
		¬ремЎтрихкод = "";
	 онец≈сли;
	
	¬озврат ¬ремЎтрихкод;

 онец‘ункции // —формироватьЎтрихкод()

//******************************************************************************
// —копировать≈диницы(Ёлемент»сточник, Ёлементѕриемник, —пис≈диниц)
//
// ѕараметры: 
//  Ёлемент»сточник, Ёлементѕриемник, —пис≈диниц
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  “екстќписани€
//
ѕроцедура —копировать≈диницы(Ёлемент»сточник, Ёлементѕриемник, —пис≈диниц)
	—пис≈диниц	= —оздатьќбъект("“аблица«начений");
	
	—пис≈диниц.Ќова€ олонка("≈диница"	, "—правочник.≈диницы");
	—пис≈диниц.Ќова€ олонка("ќ ≈»"		, "—правочник.ќ ≈»");
	
	—пр≈диницы	= —оздатьќбъект("—правочник.≈диницы");
	—пр≈диницы.»спользовать¬ладельца(Ёлементѕриемник.“екущийЁлемент());
	
	—пр≈д»ст	= —оздатьќбъект("—правочник.≈диницы");
	—пр≈д»ст.»спользовать¬ладельца(Ёлемент»сточник);
	—пр≈д»ст.¬ыбратьЁлементы();
	ѕока —пр≈д»ст.ѕолучитьЁлемент() = 1 ÷икл
		—пр≈диницы.Ќовый();
		
		—пр≈диницы.ќ ≈»			= —пр≈д»ст.ќ ≈»;
		—пр≈диницы.¬ес			= —пр≈д»ст.¬ес;
		—пр≈диницы. оэффициент	= —пр≈д»ст. оэффициент;
		
		// —формируем новый штрихкод, если он был задан в источнике
		≈сли ѕустое«начение(—пр≈д»ст.Ўтрих од) = 0 “огда
			—пр≈диницы.Ўтрих од = —формироватьЎтрихкод(Ёлементѕриемник.¬есовой, Ёлементѕриемник. од);
		 онец≈сли;
		
		—пр≈диницы.«аписать();
		
		—пис≈диниц.Ќова€—трока();
		“ек≈диница			= —пр≈диницы.“екущийЁлемент();
		—пис≈диниц.≈диница	= “ек≈диница;
		—пис≈диниц.ќ ≈»		= “ек≈диница.ќ ≈»;
		
		// устанавливаем базовую единицу
		≈сли —пр≈диницы.ќ ≈» = Ёлемент»сточник.Ѕазова€≈диница.ќ ≈» “огда
		    Ёлементѕриемник.Ѕазова€≈диница	= —пр≈диницы.“екущийЁлемент();
		 онец≈сли;
		
		// устанавливаем основную единицу
		≈сли —пр≈диницы.ќ ≈» = Ёлемент»сточник.ќсновна€≈диница.ќ ≈» “огда
		    Ёлементѕриемник.ќсновна€≈диница	= —пр≈диницы.“екущийЁлемент();
		 онец≈сли;
	 онец÷икла;
	
 онецѕроцедуры // —копировать≈диницы()

//******************************************************************************
// —копировать÷ены(Ёлемент»сточник, Ёлементѕриемник, —пис≈диниц)
//
// ѕараметры: 
//  Ёлемент»сточник, Ёлементѕриемник, —пис≈диниц
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  “екстќписани€
//
ѕроцедура —копировать÷ены(Ёлемент»сточник, Ёлементѕриемник, —пис≈диниц)
	
	—пр÷ены	= —оздатьќбъект("—правочник.÷ены");
	—пр÷ены.»спользовать¬ладельца(Ёлементѕриемник.“екущийЁлемент());
	—пр÷ены.»спользоватьƒату('01.01.1980');
	
	—пр÷ены»ст	= —оздатьќбъект("—правочник.÷ены");
	—пр÷ены»ст.»спользовать¬ладельца(Ёлемент»сточник);
	—пр÷ены»ст.»спользоватьƒату(–абоча€ƒата());
	—пр÷ены»ст.¬ыбратьЁлементы();
	ѕока —пр÷ены»ст.ѕолучитьЁлемент() = 1 ÷икл
		—пр÷ены.Ќовый();
		—пр÷ены.“ип÷ен	= —пр÷ены»ст.“ип÷ен;
		—пр÷ены.÷ена	= —пр÷ены»ст.÷ена;
		—пр÷ены.¬алюта	= —пр÷ены»ст.¬алюта;
		—пр÷ены.ѕроцент	= —пр÷ены»ст.ѕроцент;
		
		// в цене источнике указана единица другого товара
		// найдем нужную единицу текущего товара по ќ ≈»
		ѕоз	= 0;
		≈сли —пис≈диниц.Ќайти«начение(—пр÷ены»ст.≈диница.ќ ≈», ѕоз, "ќ ≈»") =1 “огда
		    —пр÷ены.≈диница	= —пис≈диниц.ѕолучить«начение(ѕоз, "≈диница");
			—пр÷ены.«аписать();
		 онец≈сли;
	 онец÷икла;
	
 онецѕроцедуры // —копировать÷ены()

//******************************************************************************
// —копировать—войства(Ёлемент»сточник, Ёлементѕриемник)
//
// ѕараметры: 
//  Ёлемент»сточник, Ёлементѕриемник
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  “екстќписани€
//
ѕроцедура —копировать—войства(Ёлемент»сточник, Ёлементѕриемник)
	
	ќсн—войство	= Ёлемент»сточник.ќсновное—войство;

	—пр—войства	= —оздатьќбъект("—правочник.—войстваЌоменклатуры");
	—пр—войства.»спользовать¬ладельца(Ёлементѕриемник.“екущийЁлемент());
	
	—пр—войства»ст	= —оздатьќбъект("—правочник.—войстваЌоменклатуры");
	—пр—войства»ст.»спользовать¬ладельца(Ёлемент»сточник);
	
	—пр—войства»ст.¬ыбратьЁлементы();
	ѕока —пр—войства»ст.ѕолучитьЁлемент() = 1 ÷икл
		—пр—войства.Ќовый();
		
		—пр—войства.¬ид—войства			= —пр—войства»ст.¬ид—войства;
		—пр—войства.«начение—войства	= —пр—войства»ст.«начение—войства;
		
		—пр—войства.«аписать();
		
		≈сли (ќсн—войство.¬ид—войства = —пр—войства.¬ид—войства) » (ќсн—войство.«начение—войства = —пр—войства.«начение—войства) “огда
			Ёлементѕриемник.ќсновное—войство	= —пр—войства.“екущийЁлемент();
		 онец≈сли;
	 онец÷икла;
	
 онецѕроцедуры // —копировать—войства()

//******************************************************************************
// —копироватьјналоги(Ёлемент»сточник, Ёлементѕриемник)
//
// ѕараметры: 
//  Ёлемент»сточник, Ёлементѕриемник
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  “екстќписани€
//
ѕроцедура —копироватьјналоги(Ёлемент»сточник, Ёлементѕриемник)
	
	—прјналоги	= —оздатьќбъект("—правочник.јналоги");
	—прјналоги.»спользовать¬ладельца(Ёлементѕриемник.“екущийЁлемент());
	
	—прјналоги»ст	= —оздатьќбъект("—правочник.јналоги");
	—прјналоги»ст.»спользовать¬ладельца(Ёлемент»сточник);
	
	—прјналоги»ст.¬ыбратьЁлементы();
	ѕока —прјналоги»ст.ѕолучитьЁлемент() = 1 ÷икл
		—прјналоги.Ќовый();
		
		—прјналоги.Ќаименование				= —прјналоги»ст.Ќаименование;
		—прјналоги. аталог					= —прјналоги»ст. аталог;
		—прјналоги.»дентификатор¬ аталоге	= —прјналоги»ст.»дентификатор¬ аталоге;
		
		—прјналоги.«аписать();
	 онец÷икла;

 онецѕроцедуры // —копироватьјналоги()

//******************************************************************************
// —копировать омплектующие(Ёлемент»сточник, Ёлементѕриемник)
//
// ѕараметры: 
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  “екстќписани€
//
ѕроцедура —копировать омплектующие(Ёлемент»сточник, Ёлементѕриемник)
	
	—пр омплектаци€	= —оздатьќбъект("—правочник. омплектаци€");
	—пр омплектаци€.»спользовать¬ладельца(Ёлементѕриемник.“екущийЁлемент());
	
	—пр омплектаци€»ст	= —оздатьќбъект("—правочник. омплектаци€");
	—пр омплектаци€»ст.»спользовать¬ладельца(Ёлемент»сточник);
	
	—пр омплектаци€»ст.¬ыбратьЁлементы();
	ѕока —пр омплектаци€»ст.ѕолучитьЁлемент() = 1 ÷икл
		—пр омплектаци€.Ќовый();
		
		—пр омплектаци€.Ќоменклатура	= —пр омплектаци€»ст.Ќоменклатура;
		—пр омплектаци€. оличество		= —пр омплектаци€»ст. оличество;
		—пр омплектаци€.÷еновой оэфф	= —пр омплектаци€»ст.÷еновой оэфф;
		
		—пр омплектаци€.«аписать();
	 онец÷икла;
	
 онецѕроцедуры // —копировать омплектующие()

//******************************************************************************
// —копироватьЁлемент()
//
// ѕараметры: 
//  
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  “екстќписани€
//
ѕроцедура ѕо нопке опировать()
	ѕерем —пис≈диниц;
	
	“екЁлемент	= “екущийЁлемент();
	
	≈сли ѕустое«начение(“екЁлемент) = 1 “огда
	    ѕредупреждение("Ќе выбрана номенклатура дл€ копировани€!", 60);
	»наче
		≈сли “екЁлемент.Ёто√руппа() = 1 “огда
		    ѕредупреждение("¬ыберите элемент, а не группу!", 60);
		»наче
			—прЌоменклатура	= —оздатьќбъект("—правочник.Ќоменклатура");
			—прЌоменклатура.»спользовать–одител€(“екЁлемент.–одитель);
			—прЌоменклатура.Ќовый();
			
			// копируем реквизиты
			—прЌоменклатура.Ќаименование		= “екЁлемент.Ќаименование;
			—прЌоменклатура.јртикул				= “екЁлемент.јртикул;
			—прЌоменклатура.¬есовой				= “екЁлемент.¬есовой;
			—прЌоменклатура.¬идЌоменклатуры		= “екЁлемент.¬идЌоменклатуры;
			—прЌоменклатура. омментарий			= “екЁлемент. омментарий;
			—прЌоменклатура.ћинќстаток			= “екЁлемент.ћинќстаток;
			—прЌоменклатура.Ќе¬ключать¬прайс	= “екЁлемент.Ќе¬ключать¬прайс;
			—прЌоменклатура.Ќомер√“ƒ			= “екЁлемент.Ќомер√“ƒ;
			—прЌоменклатура.ѕолнЌаименование	= “екЁлемент.ѕолнЌаименование;
			—прЌоменклатура.—тавкаЌƒ—			= “екЁлемент.—тавкаЌƒ—;
			—прЌоменклатура.—тавкаЌѕ			= “екЁлемент.—тавкаЌѕ;
			—прЌоменклатура.—транаѕроисхождени€	= “екЁлемент.—транаѕроисхождени€;
			
			Ќачать“ранзакцию();
			
				ѕопытка
					—прЌоменклатура.«аписать();
					
					—копировать≈диницы(“екЁлемент, —прЌоменклатура, —пис≈диниц);
					—копировать÷ены(“екЁлемент, —прЌоменклатура, —пис≈диниц);
					—копировать—войства(“екЁлемент, —прЌоменклатура);
					—копироватьјналоги(“екЁлемент, —прЌоменклатура);
					—копировать омплектующие(“екЁлемент, —прЌоменклатура);
					
					// запишем элемент после заполнени€ реквизитов
					// Ѕазова€≈диница, ќсновна€≈диница и ќсновное—войство
					—прЌоменклатура.«аписать();
				»сключение
					ќтменить“ранзакцию();
					ѕредупреждение(ќписаниеќшибки(), 60);
					¬озврат;
				 онецѕопытки;
			
			«афиксировать“ранзакцию();
			
			јктивизироватьќбъект(—прЌоменклатура.“екущийЁлемент());
			
			// откроем форму созданного элемента 
			ќткрыть‘орму(—прЌоменклатура.“екущийЁлемент());
				
		 онец≈сли;
	 онец≈сли;
	
 онецѕроцедуры // —копироватьЁлемент()

//******************************************************************************
// ќсновное—войство()
//
// ѕараметры: 
//  Ќет
//
// ¬озвращаемое значение:
//  «начение основного свойства
//
// ¬ызываетс€ из формул реквизитов диалога
// колонка основное свойство
//
// ќписание:
//  ‘ормирует и возращает строковое представление основного свойства
//
‘ункци€ ќсновное—войство()
	
	≈сли Ёто√руппа() = 1 “огда
		¬озврат "";
	 онец≈сли;
	
	≈сли ѕустое«начение(“екущийЁлемент()) = 1  “огда
		¬озврат "";
	»наче  
		≈сли ѕустое«начение(“екущийЁлемент().ќсновное—войство) = 1  “огда
			¬озврат "";
		»наче
			¬озврат “екущийЁлемент().ќсновное—войство.«начение—войства;
		 онец≈сли;
	 онец≈сли;
 онец‘ункции // ќсновное—войство()

//******************************************************************************
// ƒобавить¬таблицу(“абл, “овар, “ип, »сп“ип)
//
// ѕараметры:
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//
ѕроцедура ƒобавить¬таблицу(“абл, “овар, “ип)
	ѕерем ¬рем÷ена, ¬рем≈диница, ¬рем¬алюта;
	
	≈сли гл¬ернуть÷ену(“овар, “ип, –абоча€ƒата(), ¬рем÷ена, ¬рем≈диница, ¬рем¬алюта) = 1 “огда
		“абл.Ќова€—трока(); 
		“абл.јртикул   = —окрЋѕ(“овар.јртикул);
		“абл.“овар   = —окрЋѕ(“овар.ѕолнЌаименование);
		“абл.÷ена    = ¬рем÷ена;
		“абл.¬алюта  = ¬рем¬алюта;
		“абл.≈диница = ¬рем≈диница;
	»наче
		—ообщить("” товара """ + “овар.ѕолнЌаименование + """ отсутствует цена """ + “ип + """");
	 онец≈сли;	
	
 онецѕроцедуры // ƒобавить¬таблицу()

//******************************************************************************
// ѕечать÷енника(“овар, “ип÷ены)
//
// ѕараметры:
//  “овар - товар, дл€ которого нужно распечатать ценник
//  “ип÷ены - тип цены.
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//
ѕроцедура ѕечать÷енника() Ёкспорт
	ѕерем ѕеч≈диница, ѕечЌаименование, ѕеч–озн;
	ѕерем “аб;
 	ѕерем —толбик;
 	ѕерем –€д;
 	ѕерем ѕроцент, ѕор€докќкр;
 	
 	ѕерем “аб“оваров, ƒанныеƒл€ѕечати;
 	
	¬ыб“овар = “екущийЁлемент();
		
	≈сли ѕустое«начение(¬ыб“овар) = 1 “огда
		ѕредупреждение("Ќе выбрана товар или группа товаров!", 60);
		¬озврат;
	 онец≈сли;
		
    
	“ип÷ены	=	—оздатьќбъект("—правочник.“ипы÷ен");
	≈сли “ип÷ены.¬ыбрать("“ипы цен",) = 0 “огда ¬озврат  онец≈сли;
 	“ип÷ены	=	“ип÷ены.“екущийЁлемент();
	
	“аб“оваров = —оздатьќбъект("“аблица«начений");
	“аб“оваров.Ќова€ олонка("јртикул");
	“аб“оваров.Ќова€ олонка("“овар");
	“аб“оваров.Ќова€ олонка("÷ена","„исло");
	“аб“оваров.Ќова€ олонка("≈диница");
	“аб“оваров.Ќова€ олонка("¬алюта");
	
	≈сли ¬ыб“овар.Ёто√руппа() = 0 “огда
		ƒобавить¬таблицу(“аб“оваров, ¬ыб“овар, “ип÷ены);
	»наче
		—тр“ов = —оздатьќбъект("—правочник.Ќоменклатура");
		—тр“ов.»спользовать–одител€(¬ыб“овар);
		—тр“ов.¬ключатьѕодчиненные(1);
		—тр“ов.¬ыбратьЁлементы();
		
		ѕока —тр“ов.ѕолучитьЁлемент() = 1 ÷икл
			“ек“ов = —тр“ов.“екущийЁлемент();
			≈сли “ек“ов.Ёто√руппа() = 0 “огда
				ƒобавить¬таблицу(“аб“оваров, “ек“ов, “ип÷ены);
			 онец≈сли;
		 онец÷икла;
	 онец≈сли;
	
	// упакуем данные в список
	ƒанныеƒл€ѕечати = —оздатьќбъект("—писок«начений");
 	
	ƒанныеƒл€ѕечати.ƒобавить«начение(“ип÷ены.¬алюта , "¬алюта");
	ƒанныеƒл€ѕечати.ƒобавить«начение(“аб“оваров     , "“аблица");
	
	ќткрыть‘ормућодально("ќбработка.ѕечать÷енников", ƒанныеƒл€ѕечати);
	
 онецѕроцедуры // глѕечать÷енника(“овар, “ип÷ены)

//******************************************************************************
// ѕечатьЁтикетки()
//
// ѕараметры:
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  ‘ормирует этикетку. ѕеред формированием
//  этикетки провер€ет, чтобы текущий в многострочной части был выбран и 
//  он не €вл€лс€ группой.
//
ѕроцедура ѕечатьЁтикетки()
	ѕерем ѕарам;
	“екЁлем = “екущийЁлемент();
	≈сли ѕустое«начение(“екЁлем) = 1 “огда
		ѕредупреждение("Ќе выбрана номенклатурна€ позици€!", 60);
		¬озврат;
	 онец≈сли;
	
	≈сли “екЁлем.Ёто√руппа() = 1 “огда
		ѕредупреждение("Ётикетка дл€ группы номенклатуры не печатаетс€!", 60);
		¬озврат;
	 онец≈сли;
	
	≈сли “екЁлем.¬есовой = 0 “огда
		Ѕаркод = “екЁлем.Ѕазова€≈диница.Ўтрихкод;
		“абл = —оздатьќбъект("“аблица«начений");
		“абл.Ќова€ олонка("“овар", "—трока");
		“абл.Ќова€ олонка("Ўтрихкод", "—трока");
		
		“абл.Ќова€—трока();
		“абл.“овар    = —окрЋѕ(“екЁлем.Ќаименование);
		“абл.Ўтрихкод = Ѕаркод;
		
		
		ѕарам = —оздатьќбъект("—писок«начений");
		ѕарам.ƒобавить«начение(“абл, "“аблица“оваров");
		
		ќткрыть‘ормућодально("ќбработка.ѕечатьЁтикетки", ѕарам);
	»наче
		// в штрихкоде хранитьс€ 5 правых цифр кода товара
		// перед печатью нужно сформировать
		
		// получаем вес товара
		ѕарам = —оздатьќбъект("—писок«начений");
		ѕарам.ƒобавить«начение(“екЁлем					, "Ќоменклатура");
		ѕарам.ƒобавить«начение(“екЁлем.Ѕазова€≈диница	, "≈диница");
		
		ќткрыть‘орму("ќбработка.Ётикетирование#", ѕарам);
	 онец≈сли;


 онецѕроцедуры // ѕечатьЁтикетки()

//******************************************************************************
// ѕо нопкеѕечать()
//
// ѕараметры:
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//
ѕроцедура ѕо нопкеѕечать()
	
	≈сли  ѕустое«начение(Ќомер“екущей‘ормы) = 1  “огда
		Ќомер“екущей‘ормы = 1;
	 онец≈сли;
		
	≈сли Ќомер“екущей‘ормы = 1  “огда
		// Ё“» ≈“ ј
		ѕечатьЁтикетки();
	»наче≈сли Ќомер“екущей‘ормы = 2  “огда
		// ÷≈ЌЌ» 
	 	ѕечать÷енника();
	»наче
		// внешн€€ обработка
		ѕараметры = гл¬з€ть онтекст( онтекст);
		ќткрыть‘орму("ќтчет", ѕараметры, гл аталогѕеч‘орм + “аблицаѕеч‘орм.ѕолучить«начение(Ќомер“екущей‘ормы,"‘айл"));
	 онец≈сли;
	
 онецѕроцедуры // ѕо нопкеѕечать()

//******************************************************************************
// ѕо нопке¬ыборѕечатной‘ормы()
//
// ѕараметры:
//  нет.    
//
// ¬озвращаемое значение:
//  нет.
//
// ќписание:
//  - открывает список дл€ выбора способа печати. 
//  - формирует таблицу по выбранному способу.
//
ѕроцедура ѕо нопке¬ыборѕечатной‘ормы()
	
    ¬ыбЌомер = гл¬ыборѕечатной‘ормы("—правочник." + ¬ид(), “аблицаѕеч‘орм);
	≈сли ¬ыбЌомер > 0 “огда
		Ќомер“екущей‘ормы = ¬ыбЌомер;
		‘орма.кнѕечать.«аголовок(“аблицаѕеч‘орм.ѕолучить«начение(Ќомер“екущей‘ормы, " нопка"));
		ѕо нопкеѕечать();
	 онец≈сли;

 онецѕроцедуры // ѕо нопке¬ыборѕечатной‘ормы—пис()

//******************************************************************************
// ѕо нопкеќстатки()
//
// ѕараметры:
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет
//
// ¬ызываетс€ из формул элементов диалога:
//   нопка "ќстатки".
//
// ќписание:
//  ¬ызывает форму показа остатков по текущему “ћ÷ в таблице значений.
//
ѕроцедура ѕо нопкеќстатки()
	
	ѕараметр = гл¬з€ть онтекст( онтекст);
	ќткрыть‘орму("ќбработка.ѕоказатьќстатки“ћ÷", ѕараметр);
	‘орма“аблицыќстатков = ѕараметр; // через параметр возвращаетс€ контекст открытой формы обработки
	
 онецѕроцедуры // ѕо нопкеќстатки()

//******************************************************************************
// ѕо нопке—войства()
//
// ѕараметры:
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет.
//
// ¬ызываетс€ из формул элементов диалога:
//   нопка "—войства".
//
// ќписание:
//  ќткрывает справочник свойств номенклатуры.
//
ѕроцедура ѕо нопке—войства()
	
	ѕараметр = “екущийЁлемент();
	
	≈сли ѕараметр.¬ыбран() = 0 “огда
		ѕредупреждение("Ќе выбрана номенклатура", 60);
	»наче
		 онец≈сли;
	ќткрыть‘орму("—правочник.—войстваЌоменклатуры", ѕараметр); 
	
 онецѕроцедуры // ѕо нопке—войства()

//******************************************************************************
// ѕо нопкејналоги()
//
// ѕараметры:
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет.
//
// ¬ызываетс€ из формул элементов диалога:
//   нопка "јналоги".
//
// ќписание:
//  ќткрывает справочник аналогов номенклатуры.
//
ѕроцедура ѕо нопкејналоги()
	
	ѕараметр = “екущийЁлемент();
	
	≈сли ѕараметр.¬ыбран() = 0 “огда
		ѕредупреждение("Ќе выбрана номенклатура", 60);
	»наче
		ќткрыть‘орму("—правочник.јналоги", ѕараметр);
	 онец≈сли;
	
 онецѕроцедуры // ѕо нопкејналоги()

//******************************************************************************
// ѕо нопке≈диницы()
//
// ѕараметры:
//  Ќет
//
// ¬озвращаемое значение:
//  Ќет.
//
// ¬ызываетс€ из формул элементов диалога:
//   нопка "≈диницы".
//
// ќписание:
//  ќткрывает справочник единиц номенклатуры.
//
ѕроцедура ѕо нопке≈диницы()
	
	ѕараметр = “екущийЁлемент();
	
	≈сли ѕараметр.¬ыбран() = 0 “огда
		ѕредупреждение("Ќе выбрана номенклатура", 60);
	»наче
		ќткрыть‘орму("—правочник.≈диницы", ѕараметр);
	 онец≈сли;
	
 онецѕроцедуры // ѕо нопке≈диницы()                          

//******************************************************************************
// ѕо нопке÷ены()
//
// ѕараметры: 
//  Ќет
//
// ¬ызываетс€ из формул элементов диалога:
//   нопка "÷ены".
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  ќткрывает справочник цен.
//
ѕроцедура ѕо нопке÷ены()
	                                            
	ѕараметр = “екущийЁлемент();
	
	≈сли ѕараметр.¬ыбран() = 0 “огда
		ѕредупреждение("Ќе выбрана номенклатура", 60);
	»наче
		ќткрыть‘орму("—правочник.÷ены", ѕараметр);
	 онец≈сли;
	
 онецѕроцедуры // ѕо нопке÷ены()

//******************************************************************************
// ѕо нопке—правочники()
//
// ѕараметры: 
//  
//
// ¬озвращаемое значение:
//  Ќет
//
// ќписание:
//  “екстќписани€
//
ѕроцедура ѕо нопке—правочники()
	ѕерем ¬ид—пр;
	
	—пис—прав	= —оздатьќбъект("—писок«начений");
	—пис—прав.ƒобавить«начение("≈диницы"				, "≈диницы");
	—пис—прав.ƒобавить«начение("÷ены"					, "÷ены");
	—пис—прав.ƒобавить«начение("—войстваЌоменклатуры"	, "—войства");
	—пис—прав.ƒобавить«начение("јналоги"				, "јналоги");
	—пис—прав.ƒобавить«начение("ѕоставщики“оваров"		, "ѕоставщики");
	
	≈сли —пис—прав.¬ыбрать«начение(¬ид—пр, , , 60, 1) = 1 “огда
		ѕараметр = “екущийЁлемент();
		
		≈сли ѕараметр.¬ыбран() = 0 “огда
			ѕредупреждение("Ќе выбрана номенклатура", 60);
		»наче
			ќткрыть‘орму("—правочник." + ¬ид—пр, ѕараметр);
		 онец≈сли;
	 онец≈сли;
	
 онецѕроцедуры // ѕо нопке—правочники()


//******************************************************************************
// —формировать»нформационную—троку()
//
// ѕараметры:
//  Ќет
//
//	¬озвращаемое значение:
//  Ќет
//
// ¬ызываетс€ из формул элементов диалога:
//  “екст информационной строки.
//
// ќписание:
//  ‘ормирует текст информационной строки формы. 
//
‘ункци€ —формировать»нформационную—троку()
	ѕерем »нф—трока;
	
	≈сли ѕустое«начение(“екущийЁлемент()) = 1 “огда
		// не выбран элемент
		»нф—трока = "";
	»наче
		
		≈сли “екущийЁлемент().Ёто√руппа() = 1 “огда
			// текущий элемент - группа
			»нф—трока =  “екущийЁлемент().ѕолноеЌаименование();
		»наче
			
			“екЁлем = “екущийЁлемент();
			
			»нф—трока = —окрЋѕ(“екЁлем.ѕолнЌаименование) +
			            ?(ѕустое«начение(“екЁлем.јртикул) = 0, "  јртикул: " + —окрЋѕ(“екЁлем.јртикул), "") +
			            ?(ѕустое«начение(“екЁлем. омментарий) = 0, "   омментарий: " + —окрЋѕ(“екЁлем. омментарий),	"");
		
			≈сли “ип«начени€(‘орма“аблицыќстатков) = 100 “огда
				
				// если открыта форма с таблицей остатков, то обновим в ней текущий элемент
				‘орма“аблицыќстатков.‘орма.ќбновить(0);
			    
			 онец≈сли;			
		 онец≈сли;

	 онец≈сли;
	
	¬озврат »нф—трока;
	
 онец‘ункции // —формировать»нформационную—троку()

////////////////////////////////////////////////////////////////////////////////
// ѕ–≈ƒќѕ–≈ƒ≈Ћ≈ЌЌџ≈ ѕ–ќ÷≈ƒ”–џ
// 
//******************************************************************************
// ѕредопределенна€ процедура
//
ѕроцедура ѕриќткрытии()
	
	// «аполним таблицу дл€ выбора печатной формы
	Ќомер“екущей‘ормы = гл”становка нопкиѕечать( онтекст, "—правочник." + ¬ид(), “аблицаѕеч‘орм);
	
	//≈сли ѕустое«начение( онстанта.¬ид—войстваЌоменклатуры) = 0  “огда
	//	‘орма.—войство.«аголовок(—трока( онстанта.¬ид—войстваЌоменклатуры));
	//»наче
	//	‘орма.—войство.¬идимость(0);
	// онец≈сли;
	
	“«_ќстаток.Ќова€ олонка("—клад","—правочник.—клады",,,,11);
	“«_ќстаток.Ќова€ олонка("ќстаток","число",15,2,,4);
	“«_ќстаток.Ќова€ олонка("–езерв","число",15,2,,4);

	—отр=глѕользователь.“ип—отрудника;
	ѕер	=ѕеречисление.“ип—отрудника;
	Ќ—=“екущийЁлемент();
	фл—крывать»з¬осьмерки = ¬осстановить«начение("—писок_фл—крыть»з¬осьмерки");
	ѕри»зменениифл—крывать»з¬осьмерки();
 онецѕроцедуры // ѕриќткрытии()          

//******************************************************************************
// ѕредопределенна€ процедура.
//
ѕроцедура ѕри«акрытии()
	
	// если открыта форма с таблицей остатков, то закроем и ее
	≈сли “ип«начени€(‘орма“аблицыќстатков) = 100 “огда
		‘орма“аблицыќстатков.‘орма.«акрыть(0);
	 онец≈сли;			
	—охранить«начение("—писок_фл—крывать»з¬осьмерки",   фл—крывать»з¬осьмерки);
 онецѕроцедуры // ѕри«акрытии()

//******************************************************************************
ѕроцедура ќбработка¬нешнего—обыти€(»сточник,—обытие,ƒанные)
	
	ѕерем ¬рем“овар, ¬рем≈диница, ¬рем оличество;
	
	≈сли —обытие = "BarCodeValue" “огда
		≈сли глѕолучить“оварѕоЎтрихкоду(ƒанные, ¬рем“овар, ¬рем≈диница, ¬рем оличество) <> 0 “огда
			јктивизироватьќбъект(¬рем“овар);
			ќткрыть‘орму(¬рем“овар);	
		 онец≈сли;
		
		// ќбработка закончена. √отовы к получению нового штрихкода.
		гл—канерѕосылкаƒанных(1);
		
	»наче
		глќбработка¬нешнего—обыти€(»сточник, —обытие, ƒанные);	
	 онец≈сли;

 онецѕроцедуры // ќбработка¬нешнего—обыти€()

‘ункци€ ѕокажиќстатки()
	ѕерем стр;

	≈сли Ќ—=“екущийЁлемент() “огда
	    возврат 0;
	 онец≈сли;
	//≈сли ЌазваниеЌабораѕрав()="—ервис" “огда
	//	возврат 0;
	// онец≈сли;
        
	стр="";
	“«_ќстаток.”далить—троки();
	≈сли Ёто√руппа()=1 тогда
		стрк="";
		возврат стрк;
	 онец≈сли;
	—клад_“емп.¬ыбратьЁлементы();
	ѕока —клад_темп.ѕолучитьЁлемент()=1 ÷икл
		–ег1.”становить‘ильтр(,“екущийЁлемент(),—клад_темп);
		–ег1.¬ыгрузить»тоги(“«,1,1);	//¬ “« мы запомнили все остатки товаров на складе
		
		рег2.”становить‘ильтр(“екущийЁлемент(),—клад_темп);
		//	рег2.”становить«начение‘ильтра("Ќоменклатура",сп“оваров,2);
		рег2.¬ыгрузить»тоги(“«2,1,1);
		
		“«2.—вернуть("Ќоменклатура"," оличество");
		х					= ѕолучитьѕустое«начение(х);
		у					= 1;

		а=0;
		
		≈сли “«2.Ќайти«начение(“екущийЁлемент(),х,у)=1 “огда	//—начала общий резерв
			а=1;
			“«_ќстаток.Ќова€—трока();
			“«_ќстаток.—клад=—клад_“емп.“екущийЁлемент();
			“«_ќстаток.–езерв	= “«2.ѕолучить«начение(х," оличество");
			х					= ѕолучитьѕустое«начение(х);
		 онец≈сли;
		//“еперь из остатков “ћ÷
		х			= ѕолучитьѕустое«начение(х);
		у			= 2;
		≈сли “«.Ќайти«начение(“екущийЁлемент(),х,у)=1 “огда
			≈сли а=0 “огда
	    		“«_ќстаток.Ќова€—трока();
				“«_ќстаток.—клад=—клад_“емп.“екущийЁлемент();
			 онец≈сли;
			“«_ќстаток.ќстаток	= “«.ѕолучить«начение(х," оличество");
		 онец≈сли;
	 онец÷икла;
	стрк="";
	Ќ—=“екущийЁлемент();
	возврат стрк;
 онец‘ункции


ѕроцедура ѕокажиƒетализацию–езерва()
	≈сли “«_ќстаток. оличество—трок()=0 “огда
	    возврат;
	 онец≈сли;
	х	= “«_ќстаток.“екуща€—трока();
	скл	= “«_ќстаток.ѕолучить«начение(х,"—клад");
	ном	= “екущийЁлемент();
	“екƒ= "";
	 онт–езерв	= —оздатьќбъект("—писок«начений");	//ѕередача параметров в обработку "–езервы“ћ÷" 
	 онт–езерв.ƒобавить«начение(скл,"—клад");
	 онт–езерв.ƒобавить«начение(ном,"Ќоменклатура");
	 онт–езерв.ƒобавить«начение(“екƒ,"“екƒ");
	
	ќткрыть‘ормућодально("ќбработка.ѕокажи–езервы“ћ÷", конт–езерв);
	
	
 онецѕроцедуры  

//++≈рошенко 08.05.2007
ѕроцедура ќткрыть‘айл()
	          
	»м€‘ = "";
	»м€  = "\\192.168.192.129\Q\–абоча€\ћагазины\“ех»нфо\";
	≈сли ‘—.¬ыбрать‘айл(0,»м€‘,»м€ ,"¬ыберите файл дл€ просмотра","‘айлы(*.pdf)|*.pdf","pdf") = 1 “огда
		‘ = »м€  + »м€‘;
		«апуститьѕриложение(‘);  
	 онец≈сли;
	
 онецѕроцедуры
//--≈рошенко

//======================================================================
ѕроцедура ѕри»зменениифл—крывать»з¬осьмерки()
	≈сли фл—крывать»з¬осьмерки = 1 “огда
		”становитьќтбор("»з¬осьмерки",0);
	»наче
		”становитьќтбор(,);
	 онец≈сли;
 онецѕроцедуры // ѕри»зменениифл—крывать»з¬осьмерки

////////////////////////////////////////////////////////////////////////////////
// ќѕ≈–ј“ќ–џ ќ—Ќќ¬Ќќ… ѕ–ќ√–јћћџ
// 
“аблицаѕеч‘орм		= —оздатьќбъект("“аблица«начений");
“аблицаѕеч‘орм.Ќова€ олонка("Ќазвание","—трока",,,,30);
“аблицаѕеч‘орм.Ќова€ олонка("‘айл","—трока",,,"‘айл",10);
“аблицаѕеч‘орм.Ќова€ олонка(" нопка","—трока",,,,10); 
“аблицаѕеч‘орм.Ќова€ олонка("‘айлќписани€","—трока");

“аблицаѕеч‘орм.Ќова€—трока();
“аблицаѕеч‘орм.Ќазвание	= "Ётикетка";
“аблицаѕеч‘орм. нопка	= "Ётикетка";

“аблицаѕеч‘орм.Ќова€—трока();
“аблицаѕеч‘орм.Ќазвание	= "÷енник";
“аблицаѕеч‘орм. нопка	= "÷енник";

“«			= —оздатьќбъект("“аблица«начений");
“«2			= —оздатьќбъект("“аблица«начений");
–ег1		= —оздатьќбъект("–егистр.ќстатки“ћ÷");
–ег2		= —оздатьќбъект("–егистр.–езервы“ћ÷2");
—клад_темп	= —оздатьќбъект("—правочник.—клады");
—клад		= глѕользователь.ќсновной—клад;