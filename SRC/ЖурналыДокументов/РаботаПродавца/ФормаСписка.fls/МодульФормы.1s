Перем СписокДействий;  // Список действий по документу
Перем СтарыйНомер;	//Номер закладки    

Функция ЕстьОплатаПоДокументу(мТекущийДокумент)
	сп=СоздатьОбъект("Документ");
	сп.ВыбратьПодчиненныеДокументы(,,мТекущийДокумент);
	Пока сп.ПолучитьДокумент() = 1 Цикл
		если сп.Вид()="СтрокаВыпискиПриход" Тогда
			если сп.Проведен()=1 Тогда
				Возврат 1;
			КонецЕсли; 
		Иначеесли сп.Вид()="ПривязкаОплатыРозница" Тогда
			если сп.Проведен()=1 Тогда
				Возврат 1;
			КонецЕсли;
		Иначе
			РезПикт = ЕстьОплатаПоДокументу(сп.ТекущийДокумент());
			Если РезПикт = 1 Тогда
				Возврат 1;
			КонецЕсли;	
		КонецЕсли;
	КонецЦикла;
	
	Возврат 0;
КонецФункции	

Процедура ПриОткрытии()
	
	Форма.ИспользоватьЗакладки(1);
	Форма.Закладки.ДобавитьЗначение("Общий");					//1
	Форма.Закладки.ДобавитьЗначение("Расходные");				//2
	Форма.Закладки.ДобавитьЗначение("Возвраты");				//3
	Форма.Закладки.ДобавитьЗначение("Проценты");				//4
	Форма.Закладки.ДобавитьЗначение("Долги");					//5
	Форма.Закладки.ДобавитьЗначение("Заявки клиентов");			//6
	//Форма.Закладки.ДобавитьЗначение("Заявки на склад");		
	//Форма.Закладки.ДобавитьЗначение("Заявки на склад (опт)");	
	Форма.Закладки.ДобавитьЗначение("Заявки на склад (розн.)");	//7
	//Форма.Закладки.ДобавитьЗначение("Заявки на склад (перемещ.)");
	Форма.Закладки.ДобавитьЗначение("Неподтвержденные заявки");	//8
	Форма.Закладки.ДобавитьЗначение("Перемещения");				//9
    //Форма.Закладки.ДобавитьЗначение("Срочные заявки на склад");	
	Форма.Закладки.ДобавитьЗначение("Поступления");				//10
	Форма.Закладки.ДобавитьЗначение("Базовые заявки на склад");	//11
	Форма.Закладки.ДобавитьЗначение("Безнал");					//12
	Форма.Закладки.ДобавитьЗначение("ОтгрузкаБезнал");			//13
	Форма.Закладки.ДобавитьЗначение("Рабочий день");			//14 
	Форма.Закладки.ДобавитьЗначение("Залоги");			//15
	//Форма.Закладки.ДобавитьЗначение("Кофе");					
	// Валерий МЭТР:
	//Форма.Закладки.ДобавитьЗначение("Сводные заказы");			
	
	
	ВыбСклады=глПользователь.ОсновнойСклад;
    УстановитьОтбор("СкладРозница",ВыбСклады);
	СтарыйНомер=1;
	Форма.ол.Видимость(0);
	Форма.оп.Видимость(0);
	Форма.фл.Видимость(0);
	Форма.ЕстьДолг.Видимость(0);
	Форма.об.Видимость(0);
	форма.Отгр.Видимость(0);
	
	Если НазваниеНабораПрав()="Продавец_розница" Тогда
		форма.ВыбСклады.Доступность(0);
		//форма.кнДействия.Доступность(0);
	КонецЕсли;
     
	Форма.ЗаявкаВзятоВРаботу.Видимость(0);
	Форма.ЗаявкаВыполнено.Видимость(0);
	Форма.ЗаявкаПеремещено.Видимость(0);
	
КонецПроцедуры

Процедура ПриВыбореЗакладки(Номер)
	Форма.ИспользоватьСлой("Основной", 2); 
	Форма.ФлОплачено.Видимость(0);
	Форма.ол.Видимость(0);
	Форма.оп.Видимость(0);
	Форма.Склад.Видимость(0);
	Форма.СкладПолучатель.Видимость(0);
	Форма.БезнальныйКлиент.Видимость(0);
	Форма.фл.Видимость(0);
	Форма.ЕстьДолг.Видимость(0);
	Форма.об.Видимость(0);
	форма.Отгр.Видимость(0);
	
	Форма.ЗаявкаВзятоВРаботу.Видимость(0);
	Форма.ЗаявкаВыполнено.Видимость(0);
	Форма.ЗаявкаПеремещено.Видимость(0);
	Форма.Реал.Видимость(1);
	
	Если Номер=1 Тогда	//Общий по данному магазину
	    УстановитьОтбор("СкладРозница",ВыбСклады);
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);
		Форма.ЕстьДолг.Видимость(1);
		Форма.ФлОплачено.Видимость(0);
	ИначеЕсли Номер=2 Тогда 	//Расходные накладные по данному магазину
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.РеализацияРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.РеализацияРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);
		Форма.ЕстьДолг.Видимость(1);
        Форма.ФлОплачено.Видимость(1);
	ИначеЕсли Номер=3 Тогда 	//Возвратные накладные по данному магазину
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ВозвратРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ВозвратРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);

	ИначеЕсли Номер=9 Тогда 	//Накладные по перемещениям по данному магазину
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ПеремещениеРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ПеремещениеРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
        Форма.ол.Видимость(1);
		Форма.оп.Видимость(1);
		Форма.Контрагент.Видимость(0);
		Форма.Сумма.Видимость(0);
		Форма.Склад.Видимость(1);
		Форма.СкладПолучатель.Видимость(1);
	
	ИначеЕсли Номер=4 Тогда 	//Накладные по выплатам процентов по данному магазину
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ВыплатаПроцентовРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ВыплатаПроцентовРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);

	ИначеЕсли Номер=5 Тогда 	//Накладные по долгам по данному магазину
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ВозвратДолговРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ВозвратДолговРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);

	ИначеЕсли Номер=6 Тогда 	//Накладные по заявкам клиентов по данному магазину
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ЗаявкаКлиентаРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ЗаявкаКлиентаРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);
		Форма.фл.Видимость(1);
        Форма.ФлОплачено.Видимость(1);
	//ИначеЕсли Номер=8 Тогда 	//Накладные по срочным заказам на склад по данному магазину
	//	проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
	//	если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
	//		ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ЗаявкаНаСкладСрочнаяРозница)+сокрЛП(глПользователь.ОсновнойСклад);
	//	Иначе
	//		ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ЗаявкаНаСкладСрочнаяРозница)+сокрЛП(ВыбСклады);
	//	КонецЕсли;
	//	Форма.ол.Видимость(1);
	//	Форма.Контрагент.Видимость(1);
	//	Форма.Сумма.Видимость(1);
		
	ИначеЕсли Номер=10 Тогда 	//Накладные по поступлениям товара на склад по данному магазину
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если (НазваниеНабораПрав("Продавец_Розница")=1)
			и ((глПользователь.Наименование <> "Васильева Марина")
				и (глПользователь.Наименование <> "Шугин Александр")
				и (глПользователь.Наименование <> "Дорошенко Денис")) Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ПоступлениеРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ПоступлениеРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.ол.Видимость(1);
		Форма.оп.Видимость(1);
		
	ИначеЕсли Номер=14 Тогда 	//Документы по состоянию финансов в данном магазине
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.АвторизацияРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.АвторизацияРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(0);
		Форма.Сумма.Видимость(0);

	ИначеЕсли Номер=11 Тогда 	//Документы по базовым заявкам товара
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ПлановаяЗаявка)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ПлановаяЗаявка)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(0);
		Форма.Сумма.Видимость(0);
	ИначеЕсли Номер=12 Тогда 	//Документы по безналу
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.СчетНаБНРозница)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.СчетНаБНРозница)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);
		Форма.БезнальныйКлиент.Видимость(1);
		Форма.об.Видимость(1);
		Форма.Отгр.Видимость(1);
	ИначеЕсли Номер=13 Тогда 	//Документы по безналу
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.РеализацияРозницаБезнал)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.РеализацияРозницаБезнал)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.Контрагент.Видимость(1);
		Форма.Сумма.Видимость(1);
		Форма.БезнальныйКлиент.Видимость(1);
	//ИначеЕсли Номер=14 Тогда 	//Документы по учету кофе
	//	проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
	//	если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
	//		ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ДеньгиНаКофе)+сокрЛП(глПользователь.ОсновнойСклад);
	//	Иначе
	//		ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.ДеньгиНаКофе)+сокрЛП(ВыбСклады);
	//	КонецЕсли;
	//	Форма.Контрагент.Видимость(0);
	//	Форма.Сумма.Видимость(1);
	//	Форма.БезнальныйКлиент.Видимость(0);
	// Валерий МЭТР:	
	//ИначеЕсли Номер=15 Тогда	//Сводные заказы
	//    УстановитьОтбор("СводныйЗаказПоМагазинам");
	//	Форма.Контрагент.Видимость(1); 
	//	Форма.Сумма.Видимость(0);
	//	Форма.об.Видимость(1);
	ИначеЕсли Номер = 8 Тогда //Неподтвержденные заявки
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.Неподтвержденная)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.Неподтвержденная)+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.фл.Видимость(1)
	//ИначеЕсли Номер=7 Тогда //заявки на склад общий
	//	проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
	//	если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
	//		ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+сокрЛП(глПользователь.ОсновнойСклад);
	//	Иначе
	//		ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+сокрЛП(ВыбСклады);
	//	КонецЕсли;
	//ИначеЕсли Номер=8 Тогда //заявки на склад опт
	//	проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
	//	если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
	//		ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+"Опт"+сокрЛП(глПользователь.ОсновнойСклад);
	//	Иначе
	//		ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+"Опт"+сокрЛП(ВыбСклады);
	//	КонецЕсли;
	ИначеЕсли Номер=7 Тогда //заявки на склад розн.
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+"Розница";//+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+"Розница";//+сокрЛП(ВыбСклады);
		КонецЕсли;
		Форма.ЗаявкаВзятоВРаботу.Видимость(1);
		Форма.ЗаявкаВыполнено.Видимость(1);
		Форма.ЗаявкаПеремещено.Видимость(1);
		Форма.Реал.Видимость(0);
	//ИначеЕсли Номер=8 Тогда //заявки на склад перемещение
	//	проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
	//	если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
	//		ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+"Перемещение";//+сокрЛП(глПользователь.ОсновнойСклад);
	//	Иначе
	//		ЭР			= сокрЛП(Перечисление.ВидыОперацийЗаявок.НаСклад)+"Перемещение";//+сокрЛП(ВыбСклады);
	//	КонецЕсли;	
	ИначеЕсли Номер = 15 Тогда //Залоги
		проба		= СоздатьОбъект("Справочник.ОтборРознДокум");
		если НазваниеНабораПрав("Продавец_Розница")=1 Тогда
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.Залог)+сокрЛП(глПользователь.ОсновнойСклад);
		Иначе
			ЭР			= сокрЛП(Перечисление.ВидДокументаРозница.Залог)+сокрЛП(ВыбСклады);
		КонецЕсли;
	КонецЕсли;
	
	Если ((номер>1) и (номер<=17)) Тогда
		Если проба.НайтиПоНаименованию(сокрЛП(ЭР),0,1)=1 Тогда
			Отб			= проба.ТекущийЭлемент();
		Иначе
			Отб			= "";
		КонецЕсли;
		
		Если номер = 7 Тогда
			УстановитьОтбор("ВидТипДокументаРозницаБезСклада",Отб);
		//ИначеЕсли (номер = 8) Тогда
		//	УстановитьОтбор("ВидТипДокументаРозницаБезСклада",Отб);
		Иначе
			УстановитьОтбор("ВидДокументаРозница",Отб);
		КонецЕсли;	
	
	КонецЕсли;
	СтарыйНомер=Номер;
КонецПроцедуры	
               
Функция ПолучитьПиктограмму(Режим)	//Режим отображения иконки
	Если Режим = 1  Тогда
		если ТекущийДокумент.Вид()="СолянкаПоПоставкам" Тогда
			Если ТекущийДокумент.Отработан=1 Тогда
				Выплатили=1;
			Иначе
				Выплатили=2;
			КонецЕсли;
		ИначеЕсли (ТекущийДокумент.Вид()="ПоступлениеТМЦ") или (ТекущийДокумент.Вид()="ПеремещениеТМЦ_Розница") Тогда
			Если ТекущийДокумент.Набран=1 Тогда
				Выплатили=1;
			Иначе
				Выплатили=2;
			КонецЕсли;
		Иначе
			Выплатили=3;
		КонецЕсли;
		Возврат Выплатили;
	иначеесли режим=2 Тогда
		Если (ТекущийДокумент.Вид()="ПоступлениеТМЦ") или (ТекущийДокумент.Вид()="ПеремещениеТМЦ_Розница") Тогда
			Если пустоезначение(ТекущийДокумент.Принят_к_учету)=0 Тогда
				Выплатили=1;
			Иначе
				Выплатили=2;
			КонецЕсли;
		Иначе
			Выплатили=3;
		КонецЕсли;
		Возврат Выплатили;
	иначеесли режим=3 Тогда
		Если (ТекущийДокумент.Вид()="ЗаявкаКлиентаРозница") Тогда
			ТЗ 	= СоздатьОбъект("ТаблицаЗначений");
			Рег	= СоздатьОбъект("Регистр.ЗаявкиНаСклад");
			Рег.УстановитьФильтр(ТекущийДокумент,,);
			Рег.ВыгрузитьИтоги(ТЗ,1,1);
		
			Рег2	= СоздатьОбъект("Регистр.ЗаявкиНаСкладОтгружено");
						
			ТЗ.Свернуть("Заявка","КоличествоОбработано,КоличествоВОбработке");
						
			ТаблицаДокумента = СоздатьОбъект("ТаблицаЗначений");
			ТекущийДокумент.ВыгрузитьТабличнуюЧасть(ТаблицаДокумента);
			
			КоличествоСтрок = ТаблицаДокумента.КоличествоСтрок();
			
			Пока КоличествоСтрок > 0 Цикл
				ТаблицаДокумента.ПолучитьСтрокуПоНомеру(КоличествоСтрок);
				Если ТаблицаДокумента.ОтгружаетсяСоСклада <> Перечисление.ВариантыОтгрузки.СЦентральногоСклада Тогда
					ТаблицаДокумента.УдалитьСтроку(КоличествоСтрок);
				КонецЕсли;
				КоличествоСтрок = КоличествоСтрок - 1;
			КонецЦикла;	
			
			ВсегоКоличество = ТаблицаДокумента.Итог("Количество");
			
			ВсегоОбработано 	= ТЗ.Итог("КоличествоОбработано");
			ВсегоВОбработке 	= ТЗ.Итог("КоличествоВОбработке");
			ВсегоОтгружено	 	= Рег2.СводныйИтог(ТекущийДокумент,,,"КоличествоОтгружено");
			
			Если ВсегоКоличество = 0 Тогда
				Выплатили = 0;
			ИначеЕсли ВсегоОтгружено = ВсегоКоличество Тогда 
				Выплатили = 4;
			ИначеЕсли ((ВсегоОбработано + ВсегоОтгружено) > 0) и ((ВсегоОбработано + ВсегоОтгружено) <> ВсегоКоличество) Тогда 
				Выплатили = 2;	
			Иначе
				Выплатили = 0;
			КонецЕсли;
		ИначеЕсли (ТекущийДокумент.Вид()="ЗаявкаПокупателя") Тогда 
			Если ТекущийДокумент.ВидОперации = Перечисление.ВидыОперацийЗаявок.Неподтвержденная Тогда
				ТЗ 	= СоздатьОбъект("ТаблицаЗначений");
				Рег	= СоздатьОбъект("Регистр.ЗаявкиНаСклад");
				Рег.УстановитьФильтр(ТекущийДокумент,,);
				Рег.ВыгрузитьИтоги(ТЗ,1,1);
				
				Рег2	= СоздатьОбъект("Регистр.ЗаявкиНаСкладОтгружено");
				
				ТЗ.Свернуть("Заявка","КоличествоОбработано,КоличествоВОбработке");
				
				ТаблицаДокумента = СоздатьОбъект("ТаблицаЗначений");
				ТекущийДокумент.ВыгрузитьТабличнуюЧасть(ТаблицаДокумента);
				
				ВсегоКоличество = ТаблицаДокумента.Итог("Количество");
				
				ВсегоОбработано 	= ТЗ.Итог("КоличествоОбработано");
				ВсегоВОбработке 	= ТЗ.Итог("КоличествоВОбработке");
				ВсегоОтгружено	 	= Рег2.СводныйИтог(ТекущийДокумент,,,"КоличествоОтгружено");
				
				Если ВсегоКоличество = 0 Тогда
					Выплатили = 0;
				ИначеЕсли ВсегоОтгружено = ВсегоКоличество Тогда 
					Выплатили = 4;
				ИначеЕсли ((ВсегоОбработано + ВсегоОтгружено) > 0) и ((ВсегоОбработано + ВсегоОтгружено) <> ВсегоКоличество) Тогда 
					Выплатили = 2;	
				Иначе
					Выплатили = 0;
				КонецЕсли;	
			КонецЕсли;
		Иначе
			Выплатили=3;
		КонецЕсли;
		Возврат Выплатили;
	ИначеЕсли режим=4 Тогда
		Если (ТекущийДокумент.Вид()="СчетБнРозница") Тогда
			Если ЕстьОплатаПоДокументу(ТекущийДокумент) = 1 Тогда     
				 Выплатили=1;
			КонецЕсли;	 
			
			Возврат Выплатили;
		КонецЕсли;
	ИначеЕсли режим=5 Тогда
		Если (ТекущийДокумент.Вид()="СчетБнРозница") Тогда
			сп=СоздатьОбъект("Документ");
			сп.ВыбратьПодчиненныеДокументы(,,ТекущийДокумент);
			Пока сп.ПолучитьДокумент() = 1 Цикл
				если сп.Вид()="РасходнаяНакладнаяРозницаБезнал" Тогда
					если сп.Проведен()=1 Тогда
						Выплатили=1;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
		Возврат Выплатили;
		КонецЕсли;
	ИначеЕсли режим=6 Тогда	//ГАВ 10/04/2008
		Если (ТекущийДокумент.Вид()="РасходнаяНакладнаяРозницаБезнал") Тогда
			сп	= СоздатьОбъект("Документ");
			сп.ВыбратьПодчиненныеДокументы(,,ТекущийДокумент);
			Пока сп.ПолучитьДокумент() = 1 Цикл
				если сп.Вид()="Реализация" Тогда
					если сп.Проведен()=1 Тогда
						Выплатили=1;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			Возврат Выплатили;
		ИначеЕсли (ТекущийДокумент.Вид()="СчетБнРозница") Тогда
			сп	= СоздатьОбъект("Документ");
			сп.ВыбратьПодчиненныеДокументы(,,ТекущийДокумент);
			Пока сп.ПолучитьДокумент() = 1 Цикл
				Если  (Найти(сп.Вид(), "Расходная") > 0) Тогда
					спР	= СоздатьОбъект("Документ");
					спР.ВыбратьПодчиненныеДокументы(,,сп);
					Пока спР.ПолучитьДокумент() = 1 Цикл
						если (Найти(спР.Вид(), "Реализация") > 0) Тогда
							если спР.Проведен()=1 Тогда
								Выплатили=1;
								Прервать;
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
			Возврат Выплатили;
		ИначеЕсли (ТекущийДокумент.Вид()="ЗаявкаПокупателя") Тогда
			Если ТекущийДокумент.ВидОперации = Перечисление.ВидыОперацийЗаявок.НаСклад Тогда
				//Проверим есть ли проведенное перемещение в розницу*************************************
				//если есть установим признак "Перемещено"***********************************************
				Если (ТекущийДокумент.ДокОснование.Вид() = "ЗаявкаКлиентаРозница") и (ТекущийДокумент.ЗаявкаПеремещена = 0) Тогда
					ДокПодч			= СоздатьОбъект("Документ");
					флПеремещено 	= 0;
					ДокПодч.ВыбратьПодчиненныеДокументы(,,ТекущийДокумент);
					Пока ДокПодч.ПолучитьДокумент()=1 Цикл
						Если (ДокПодч.Вид() = "ПеремещениеТМЦ_Розница") Тогда
							Если (ДокПодч.ПометкаУдаления() = 0) и (ДокПодч.Проведен() = 1) Тогда
								флПеремещено = 1;
								Прервать;
							КонецЕсли;	
						КонецЕсли;
					КонецЦикла;
				Иначе
					флПеремещено = ТекущийДокумент.ЗаявкаПеремещена;
				КонецЕсли;
				//***************************************************************************************
				
				Если ТекущийДокумент.ЗаявкаПеремещена = 1 Тогда
					Выплатили = 4;
				ИначеЕсли ТекущийДокумент.ЗаявкаОбработана = 1 Тогда
					Выплатили = 1;
				ИначеЕсли ТекущийДокумент.ЗаявкаВзятаВРаботу = 1 Тогда
					Выплатили = 5;
				ИначеЕсли (флПеремещено = 0)
				и (ТекущийДокумент.ЗаявкаВзятаВРаботу = 0)
				и (ТекущийДокумент.ЗаявкаОбработана = 0) Тогда
					Выплатили = 0;
				Иначе
					Выплатили = 1;
				КонецЕсли;
			ИначеЕсли ТекущийДокумент.ВидОперации = Перечисление.ВидыОперацийЗаявок.Неподтвержденная Тогда
				ТЗ 	= СоздатьОбъект("ТаблицаЗначений");
				Рег	= СоздатьОбъект("Регистр.ЗаявкиНаСклад");
				Рег.УстановитьФильтр(ТекущийДокумент,,);
				Рег.ВыгрузитьИтоги(ТЗ,1,1);  
				
				Рег2	= СоздатьОбъект("Регистр.ЗаявкиНаСкладОтгружено");
				
				ТЗ.Свернуть("Заявка","КоличествоОбработано,КоличествоВОбработке");
				
				ТаблицаДокумента = СоздатьОбъект("ТаблицаЗначений");
				ТекущийДокумент.ВыгрузитьТабличнуюЧасть(ТаблицаДокумента);
				
				ТаблицаДокумента = СоздатьОбъект("ТаблицаЗначений");
				ТекущийДокумент.ВыгрузитьТабличнуюЧасть(ТаблицаДокумента); 
				
				ВсегоКоличество = ТаблицаДокумента.Итог("Количество");
				ВсегоОбработано = ТЗ.Итог("КоличествоОбработано");
				ВсегоВОбработке = ТЗ.Итог("КоличествоВОбработке"); 
				ВсегоОтгружено	= Рег2.СводныйИтог(ТекущийДокумент,,,"КоличествоОтгружено"); 
				
				Если ВсегоКоличество = 0 Тогда
					Выплатили = 1;
				ИначеЕсли (ВсегоОбработано + ВсегоОтгружено) = ВсегоКоличество Тогда 
					Выплатили = 1;
				ИначеЕсли ВсегоВОбработке <> 0 Тогда
					Выплатили = 5;	
				Иначе
					Выплатили = 0;
				КонецЕсли;		
			КонецЕсли;
			Возврат Выплатили; 
		ИначеЕсли (ТекущийДокумент.Вид()="ЗаявкаКлиентаРозница") Тогда //или (ТекущийДокумент.Вид()="ПеремещениеТМЦ_Розница") Тогда
			ТЗ 	= СоздатьОбъект("ТаблицаЗначений");
			Рег	= СоздатьОбъект("Регистр.ЗаявкиНаСклад");
			Рег.УстановитьФильтр(ТекущийДокумент.ТекущийДокумент());
			Рег.ВыгрузитьИтоги(ТЗ,1,1);
			
			Рег2	= СоздатьОбъект("Регистр.ЗаявкиНаСкладОтгружено");
			//Рег2.ИспользоватьПериод(ДатаГод(ТекущаяДата()));
			
			ТЗ.Свернуть("Заявка","КоличествоОбработано,КоличествоВОбработке");
						
			ТаблицаДокумента = СоздатьОбъект("ТаблицаЗначений");
			ТекущийДокумент.ВыгрузитьТабличнуюЧасть(ТаблицаДокумента);
			
			Если ТекущийДокумент.Вид()="ЗаявкаКлиентаРозница" Тогда
				КоличествоСтрок = ТаблицаДокумента.КоличествоСтрок();
				
				Пока КоличествоСтрок > 0 Цикл
					ТаблицаДокумента.ПолучитьСтрокуПоНомеру(КоличествоСтрок);
					Если ТаблицаДокумента.ОтгружаетсяСоСклада <> Перечисление.ВариантыОтгрузки.СЦентральногоСклада Тогда
						ТаблицаДокумента.УдалитьСтроку(КоличествоСтрок);
					КонецЕсли;
					КоличествоСтрок = КоличествоСтрок - 1;
				КонецЦикла;	
			КонецЕсли;
			
			ВсегоКоличество = ТаблицаДокумента.Итог("Количество");
			
			ВсегоОбработано 	= ТЗ.Итог("КоличествоОбработано");
			ВсегоВОбработке 	= ТЗ.Итог("КоличествоВОбработке");
			ВсегоОтгружено	 	= Рег2.СводныйИтог(ТекущийДокумент,,,"КоличествоОтгружено"); 
			
			Если ВсегоКоличество = 0 Тогда
				Выплатили = 1;
			ИначеЕсли (ВсегоОбработано + ВсегоОтгружено) = ВсегоКоличество Тогда 
				Выплатили = 1;
			ИначеЕсли ВсегоВОбработке <> 0 Тогда
				Выплатили = 5;	
			Иначе
				Выплатили = 0;
			КонецЕсли;
			
		    Возврат Выплатили;
		КонецЕсли;
	иначеесли режим=7 Тогда 
		Если ТекущийДокумент.Вид()="ЗаявкаПокупателя" Тогда
			Если ТекущийДокумент.ВидОперации = Перечисление.ВидыОперацийЗаявок.НаСклад Тогда
				Если ТекущийДокумент.ЗаявкаВзятаВРаботу = 1 Тогда
					Выплатили = 1;
				Иначе
					Выплатили = 0;
				КонецЕсли;
			КонецЕсли;
		Иначе
			Выплатили=0;
		КонецЕсли;    
		Возврат Выплатили;
	иначеесли режим=8 Тогда
		Если ТекущийДокумент.Вид()="ЗаявкаПокупателя" Тогда
			Если ТекущийДокумент.ВидОперации = Перечисление.ВидыОперацийЗаявок.НаСклад Тогда
				Если  ТекущийДокумент.ЗаявкаОбработана = 1 Тогда
					Если  ТекущийДокумент.Итог("Количество") = ТекущийДокумент.Итог("КоличествоФакт") Тогда
						Возврат  1; 
					Иначе
						Возврат  2; 
					КонецЕсли;	
				Иначе
					Выплатили = 0;
				КонецЕсли;
			КонецЕсли;		
		Иначе
			Выплатили=0;
		КонецЕсли;	  
		Возврат Выплатили;
	иначеесли режим=9 Тогда
		Если ТекущийДокумент.Вид()="ЗаявкаПокупателя" Тогда
			Если ТекущийДокумент.ВидОперации = Перечисление.ВидыОперацийЗаявок.НаСклад Тогда
				Если (ТекущийДокумент.ЗаявкаПеремещена = 1) Тогда
					Выплатили = 1;
				Иначе
					//Проверим есть ли проведенное перемещение в розницу*************************************
					//если есть установим признак "Перемещено"***********************************************
					Если ТекущийДокумент.ДокОснование.Вид() = "ЗаявкаКлиентаРозница" Тогда
						ДокПодч			= СоздатьОбъект("Документ");
						Выплатили = 0;
						ДокПодч.ВыбратьПодчиненныеДокументы(,,ТекущийДокумент);
						Пока ДокПодч.ПолучитьДокумент()=1 Цикл
							Если (ДокПодч.Вид() = "ПеремещениеТМЦ_Розница") Тогда
								Если (ДокПодч.ПометкаУдаления() = 0) и (ДокПодч.Проведен() = 1) Тогда
									Выплатили = 1;
									Прервать;
								КонецЕсли;	
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
					//***************************************************************************************
				КонецЕсли;
			КонецЕсли;		
		Иначе
			Выплатили=0;
		КонецЕсли;   
		Возврат Выплатили; 
	иначеесли режим=10 Тогда
		ТекЗаявка = глПолучитьЗаявку(ТекущийДокумент);
		Если ПустоеЗначение(ТекЗаявка) = 0 Тогда
			Если (ТекЗаявка.Вид() = "ЗаявкаКлиентаРозница") Тогда
				Если (ПустоеЗначение(ТекЗаявка.СсылкаДляОплаты) = 0)
					и (ПустоеЗначение(ТекЗаявка.НомерЗаявкиСайт) = 0) Тогда   
					ПодчДок = СоздатьОбъект("Документ");
					ПодчДок.ВыбратьПодчиненныеДокументы(,,ТекЗаявка.ТекущийДокумент());
					
					Пока ПодчДок.ПолучитьДокумент() = 1 Цикл
						Если ПодчДок.ПометкаУдаления() = 1 Тогда
							Продолжить;
						КонецЕсли;
						Если (ПодчДок.Вид() = "ПолучениеЗалога_Розница") Тогда
							Если (ПодчДок.ПоКарте = 1) Тогда   
								Выплатили = 1;
								Прервать;
							КонецЕсли;
						ИначеЕсли (ПодчДок.Вид() = "ПривязкаОплатыРозница") Тогда
							//Если (ПодчДок.ПоКарте = 1) Тогда   
								Выплатили = 1;
								Прервать;
							//КонецЕсли;	
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;			
			КонецЕсли;
		КонецЕсли;
		Возврат Выплатили;
	КонецЕсли;
КонецФункции 
//Задумин

////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ
//
//Инициализирум список действий по кнопке "Действия"
СписокДействий = СоздатьОбъект("СписокЗначений");
Если НазваниеНабораПрав()="Продавец_розница" Тогда
	СписокДействий.ДобавитьЗначение("Структура подчиненности");
Иначе	
	СписокДействий.ДобавитьЗначение("Структура подчиненности");
	СписокДействий.ДобавитьЗначение("Отчет о движениях документа");  
	СписокДействий.ДобавитьЗначение("Ввести на основании");
	СписокДействий.ДобавитьЗначение("Скопировать в...");  
КонецЕсли;
