Перем СписокДействий; // для механизма кнопки "Действия"

Перем ТаблицаПечФорм;  // список печатных форм документа
Перем НомерТекущейФормы;
Перем ТЗ_товара;
Перем ТипЦены;
            
Процедура ПриЗаписи()
	ПриЗаписиДокумента(Контекст);
КонецПроцедуры	

Процедура ПриОткрытии()
	если ПустоеЗначение(ТипЦены)=1 Тогда
		Предупреждение("Внимание! Преждем чем работать с данным документом, укажите в параметрах пользователя основной тип цен продажи.");
		Возврат;
	КонецЕсли;
	Форма.Номенклатура.ВыполнятьФормулуТолькоПриИзменении(1);
	Форма.Единица.ВыполнятьФормулуТолькоПриИзменении(1);
	Форма.Коэффициент.ВыполнятьФормулуТолькоПриИзменении(1);
	Форма.ЦенаНов.ВыполнятьФормулуТолькоПриИзменении(1);
	Форма.ОбщВалюта.ВыполнятьФормулуТолькоПриИзменении(1);
	
	Если НазваниеНабораПрав()="Продавец_розница" Тогда
		форма.ТолькоПросмотр(1);
		Форма.кнПодбор.Доступность(0);
		Форма.кнВнесиГруппу.Доступность(0);
		Форма.кнНаценка.Доступность(0);
		Форма.кнЗаполни.Доступность(0);
		Форма.кнИмпорт.Доступность(0);
	КонецЕсли;
	//Инициализирум список действий по кнопке "Действия"
	СписокДействий = СоздатьОбъект("СписокЗначений");

	
	СписокДействий.ДобавитьЗначение("Добавить из документа");
КонецПроцедуры 


//++Горлач Печать текущих ценников. Взято из справочника Номенклатура
//******************************************************************************
// ДобавитьВтаблицу(Табл, Товар, Тип, ИспТип)
//
// Параметры:
//  Нет
//
// Возвращаемое значение:
//  Нет
//
// Описание:
//
Процедура ДобавитьВтаблицу(Табл, Товар, Тип)
	Перем ВремЦена, ВремЕдиница, ВремВалюта;
	
	Если глВернутьЦену(Товар, Тип, РабочаяДата(), ВремЦена, ВремЕдиница, ВремВалюта) = 1 Тогда
		Табл.НоваяСтрока();
		Табл.Товар   		= СокрЛП(Товар.ПолнНаименование);
		Табл.Цена		    = ВремЦена;
		Табл.Валюта			= ВремВалюта;
		Табл.Единица		= ВремЕдиница;
		Табл.Производитель	= СокрЛП(Товар.СтранаПроисхождения);
		Табл.Артикул		= СокрЛП(Товар.Артикул);
	Иначе
		Сообщить("У товара """ + Товар.ПолнНаименование + """ отсутствует цена """ + Тип + """");
	КонецЕсли;	
	
КонецПроцедуры // ДобавитьВтаблицу()

//******************************************************************************
// ПечатьЦенника(Товар, ТипЦены)
//
// Параметры:
//  Товар - товар, для которого нужно распечатать ценник
//  ТипЦены - тип цены.
//
// Возвращаемое значение:
//  Нет
//
// Описание:
//
Процедура ПечатьЦенника() Экспорт
	Перем ПечЕдиница, ПечНаименование, ПечРозн;
	Перем Таб;
	Перем Столбик;
	Перем Ряд;
	Перем Процент, ПорядокОкр;
	
	Перем ТабТоваров, ДанныеДляПечати; 
	
	Перем Докум, ДокумВид;
	Докум = ТекущийДокумент();
	ДокумВид = Докум.Вид();  
	//Если ДокумВид = "ПереоценкаРозница" Тогда
	//	ИдРознЦена = "ЦенаНовая";
	Если ДокумВид = "ПереоценкаНовая" Тогда
		ИдРознЦена = "ЦенаНов";
	ИначеЕсли ДокумВид = "ПоступлениеТМЦРозница" Тогда
		ИдРознЦена = "РозничнаяЦена";
	ИначеЕсли ДокумВид = "ПеремещениеТМЦ" Тогда
		Если Докум.СкладПолучатель.РозничныйСклад = 1 Тогда
			ИдРознЦена = "Цена";
		Иначе
			Предупреждение("Нельзя печатать ценники при перемещении 
			               |ТМЦ на оптовый склад!", 60);
			Возврат;    
		КонецЕсли;
	Иначе
		Возврат;    
	КонецЕсли;
	
	
	ТипЦены	=	глПользователь.ОсновнойТипЦенПродажи;
	
	ТабТоваров = СоздатьОбъект("ТаблицаЗначений");
	ТабТоваров.НоваяКолонка("Товар");
	ТабТоваров.НоваяКолонка("Цена","Число");
	ТабТоваров.НоваяКолонка("Единица");
	ТабТоваров.НоваяКолонка("Валюта");
	ТабТоваров.НоваяКолонка("Производитель");
	ТабТоваров.НоваяКолонка("Артикул");   
	
	Докум.ВыбратьСтроки();
 	Пока Докум.ПолучитьСтроку() = 1 Цикл
		Если ДокумВид = "ПереоценкаРозница" Тогда // пропускаем ТМЦ, где цена не менялась
	 		Если Докум.ЦенаСтарая = Докум.ЦенаНовая Тогда
	 			Продолжить;    
	 		КонецЕсли;
 		КонецЕсли;
	 	  ВремЦена = Докум.ПолучитьАтрибут(ИдРознЦена);
	 	  ТекТов = Докум.Номенклатура;
	 	  ДобавитьВтаблицу(ТабТоваров, ТекТов, ТипЦены);
	КонецЦикла;
	
	
	// упакуем данные в список
	ДанныеДляПечати = СоздатьОбъект("СписокЗначений");
	
	Фирма = СокрЛП(глЗначениеПоУмолчанию("ОсновнаяФирма").ЮрЛицо.ПолнНаименование);
	ДанныеДляПечати.ДобавитьЗначение(Фирма          , "Фирма");
	ДанныеДляПечати.ДобавитьЗначение(ТипЦены.Валюта , "Валюта");
	ДанныеДляПечати.ДобавитьЗначение(ТабТоваров     , "Таблица");
	
	ОткрытьФорму("Обработка.ПечатьЦенника_Розница", ДанныеДляПечати);
	
КонецПроцедуры // глПечатьЦенника(Товар, ТипЦены)
//--Горлач


//******************************************************************************
// ПоКнопкеПодбор()
//
// Параметры:
//  нет.
//
// Возвращаемое значение:
//  нет.
//
// Описание:

Процедура ПоКнопкеПодбор()
	
	Параметры = СоздатьОбъект("СписокЗначений");
	Параметры.ДобавитьЗначение(Фирма,     		"Фирма");
	Параметры.ДобавитьЗначение(0,         		"ЕстьВидТМЦ");
	Параметры.ДобавитьЗначение("ИзСправочника",	"ЦенаВподборе");
	Параметры.ДобавитьЗначение(ТипЦены.Валюта,	"Валюта");
	Курс	= ТипЦены.Валюта.Курс.Получить(ДатаДок);
	Параметры.ДобавитьЗначение(Курс,			"Курс");
	Параметры.ДобавитьЗначение(ТипЦены,			"ТипЦен");
	
	Если Выбран() = 0 Тогда
		Параметры.ДобавитьЗначение("Дата",  "ТипГраницы");
		Параметры.ДобавитьЗначение(ДатаДок, "ЗначениеГраницы");
	Иначе
		Параметры.ДобавитьЗначение("Позиция",         "ТипГраницы");
		Параметры.ДобавитьЗначение(ПолучитьПозицию(), "ЗначениеГраницы");
	КонецЕсли;
	
	Параметры.ДобавитьЗначение("Подбор номенклатуры в документ " + ПредставлениеВида() + " № " + НомерДок, "Заголовок");
	глПодбор(Контекст, Параметры);
	
	ВыбратьСтроки();
	Пока ПолучитьСтроку()=1 цикл
		артикул			= Номенклатура.Артикул;
		производитель	= номенклатура.Производитель;
	КонецЦикла;
КонецПроцедуры // ПоКнопкеПодбор()

Процедура ВводНового(Скопирован)
	глЗаполнитьШапку(Контекст, Скопирован);
	
	Если Скопирован = 1 Тогда	//копирование документа 
		Возврат;
	КонецЕсли;                              
	
КонецПроцедуры

//******************************************************************************
// Предопределенная процедура
//
Процедура ОбработкаПодбора(ВыбЗнач, КонтФормыПодбора)
	
	Перем ТабТоварыВсоставе, ТаблицаПодбора;
	
	ТипЗнач		= ТипЗначенияСтр(ВыбЗнач);
	Если ТипЗнач = "СписокЗначений" Тогда
		
		ТаблицаПодбора = ВыбЗнач.Получить("ТаблицаПодбора");
	Иначе
		
		// если не список ничего не делаем
		Возврат;
	КонецЕсли;
	
	ТипЗнач	= ТипЗначенияСтр(ТаблицаПодбора);
	Если ТипЗнач = "ТаблицаЗначений" Тогда
		ВыгрузитьТабличнуюЧасть(ТабТоварыВсоставе, "Единица, НомерСтроки, ЦенаСтар");
		
		ТаблицаПодбора.ВыбратьСтроки();
		Пока ТаблицаПодбора.ПолучитьСтроку() = 1 Цикл
			ТекНоменклатура	= ТаблицаПодбора.Номенклатура;
			ТекЕдиница		= ТаблицаПодбора.Единица;
			
			Если ТекНоменклатура <> ТекЕдиница.Владелец Тогда
				Сообщить("В подборе выбрана единица другого элемента справочника Номенклатура.
				|Проверьте правильность указания базовой и основной единицы для элемента
				|""" + СокрЛП(ТекНоменклатура) + """, а также правильность указания единиц измерения 
				|в справочниках единиц и цен для данной позиции номенклатуры." );
				Продолжить;
			КонецЕсли;
			
			// ищем номенклатуру вместе с ценой среди подобранных
			Поз	= 0; 
			ТабТоварыВсоставе.ВыбратьСтроки();
			Пока ТабТоварыВсоставе.ПолучитьСтроку() = 1 Цикл
				Если (ТабТоварыВсоставе.ЦенаСтар = ТаблицаПодбора.Цена) И (ТабТоварыВсоставе.Единица = ТекЕдиница) Тогда
					Поз = ТабТоварыВсоставе.НомерСтроки;
					Прервать;  // Нашли
				КонецЕсли;
			КонецЦикла;
			
			Если Поз > 0 Тогда
				
				// нашли, увеличиваем количество
				ПолучитьСтрокуПоНомеру(Поз);
				Количество	= Количество + ТаблицаПодбора.Количество;
			Иначе
				НоваяСтрока();
				Номенклатура  = ТаблицаПодбора.Номенклатура;
				Единица       = ТаблицаПодбора.Единица;
				Коэффициент   = Единица.Коэффициент;    
				
				//******************************************************************************
				цен=создатьобъект("Справочник.Цены");
				Цен.ИспользоватьВладельца(Номенклатура);	//Задали, по какому элементу будем играть
				ФлагИсх=0;									//Изучаем наличие таких типов цен
				Цен.ВыбратьЭлементы();
				Пока Цен.получитьЭлемент()=1 цикл
					если Цен.ТипЦен = ТипЦены тогда
						ЦенаСтар	= Цен.Цена.Получить(ДатаДок);
						ОбщВалюта	= Цен.валюта;
						если ПустоеЗначение(ОбщВалюта)=1 Тогда	//Что-то надо проставить
							Сообщить("У номенклатуры: "+номенклатура+" нет базовой валюты, проставляем рубли.");
							ОбщВалюта	= глРубли;
						КонецЕсли;
						ФлагИсх		= 1;
						продолжить;
					КонецЕсли;
				конецЦикла;
				Если ФлагИсх=0 тогда
					ЦенаСтарОбщ		= 0;
					Сообщить("У номенклатуры: "+номенклатура+" нет базовой валюты, проставляем рубли.");
					ОбщВалюта	= глРубли;
				КонецЕсли;
				//******************************************************************************
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	ВыбратьСтроки();
	пока ПолучитьСтроку()=1 Цикл
		Артикул			= Номенклатура.Артикул;
		Производитель	= Номенклатура.Производитель;
	КонецЦикла;
	
	Активизировать("Номенклатура");
	АктивизироватьСтроку();
КонецПроцедуры // ОбработкаПодбора()

Процедура Пересчет()	//Расчёт в таблице
	Если Форма.ТекущаяКолонка()="Номенклатура" тогда
		цен	= создатьобъект("Справочник.Цены");
		Цен.ИспользоватьВладельца(Номенклатура);	//Задали, по какому элементу будем играть
		ФлагИсх=0;									//Изучаем наличие таких типов цен
		Цен.ВыбратьЭлементы();
		Пока Цен.получитьЭлемент()=1 цикл
			если Цен.ТипЦен = ТипЦены тогда
				ЦенаСтар	= Цен.Цена.Получить(ДатаДок);
				Единица		= Цен.Единица.Получить(ДатаДок);
				Коэффициент = 1;
				ФлагИсх		= 1; 
				продолжить;
			КонецЕсли;
		конецЦикла;
		Если ФлагИсх = 0 тогда
			ЦенаСтар = 0;
		КонецЕсли;
	конецЕсли;
	артикул			= Номенклатура.Артикул;
	производитель	= номенклатура.Производитель;
КонецПроцедуры

Функция НайдиСответствие(ИскомыйАртикул)
	тов=СоздатьОбъект("Справочник.Номенклатура");
	если тов.ВыбратьЭлементыПоРеквизиту("Артикул",ИскомыйАртикул,0,0)=1 Тогда
		пока тов.ПолучитьЭлемент()=1 Цикл
			НоваяСтрока();
			Номенклатура=тов.ТекущийЭлемент();
		КонецЦикла;
		рез=1;
	Иначе
		Сообщить("Для артикула: ("+ИскомыйАртикул+") в базе нет соответствия!","!");
		рез=0;
	КонецЕсли;
    
	Возврат рез;
КонецФункции
		


//Создаёт завязку на импртированный Excel файл и хавает данные оттуда, потом убивая данные временного справочника
Процедура ИмпортТоваровИЦен()
	УдалитьСтроки();
	спр=СоздатьОбъект("Справочник.ИмпортДанных");
	спр.ВыбратьЭлементы();
	пока спр.ПолучитьЭлемент()=1 Цикл
		Состояние("Обрабатываем: "+спр.Код);
		если НайдиСответствие(спр.Артикул)=1 Тогда
			Артикул			= Номенклатура.Артикул;
			Производитель	= Номенклатура.Производитель;
			Единица			= Номенклатура.БазоваяЕдиница;
			Коэффициент		= 1;
			ЦенаНов			= спр.Цена;
			
			цен				= создатьобъект("Справочник.Цены");
			Цен.ИспользоватьВладельца(Номенклатура);	//Задали, по какому элементу будем играть
			ФлагИсх=0;ФлагКон=0;	//Изучаем наличие таких типов цен
			Цен.ВыбратьЭлементы();
			Пока Цен.получитьЭлемент()=1 цикл
				если Цен.ТипЦен	= ТипЦены тогда
					ЦенаСтар	= Цен.Цена.Получить(ДатаДок);
					Единица		= Цен.Единица.Получить(ДатаДок);
					Коэффициент = 1;
					ФлагИсх		= 1; 
					продолжить;
				КонецЕсли;
			конецЦикла;
			Если ФлагИсх=0 тогда
				ЦенаСтарОбщ=0;
			КонецЕсли;
		конецЕсли;
	КонецЦикла;
	
	а=Вопрос("Очистить временный справочник?",4,60);
	если а=6 Тогда
		спр.ВыбратьЭлементы();
		пока спр.ПолучитьЭлемент()=1 Цикл
			Состояние("Удаляем: "+спр.Код);
			спр.Удалить(1);
		КонецЦикла;
	КонецЕсли;	
КонецПроцедуры
	
//******************************************************************************
//			ТУТ всё для печати
//******************************************************************************
// Печать(СразуНаПринтер, КолЭкз)
//
// Параметры:
//  СразуНаПринтер - (1) если печать на принтер, (0) - с предварительным просмотром
//  КолЭкз - количество экземпляров печати
//
// Возвращаемое значение:
//  нет.
//
// Описание:
//
Процедура Печать(СразуНаПринтер = 0,КолЭкз = 1)
	Перем НачПовт, КонПовт;
	
	ИсхТабл = СоздатьОбъект("Таблица");
	НачПовт = 0; КонПовт = 0;
	
	// секция Заголовок
	
	ИсхТабл.ВывестиСекцию("Заголовок");
	НачПовт = НачПовт + ИсхТабл.ВысотаСекции("Заголовок");
	
	// Фирма
	ИсхТабл.ВывестиСекцию("Фирма");
	НачПовт = НачПовт + ИсхТабл.ВысотаСекции("Фирма");
	
	// Секция Склад
	ИсхТабл.ВывестиСекцию("Склад");
	НачПовт = НачПовт + ИсхТабл.ВысотаСекции("Склад");
	
	// Секция Шапка таблицы
	ИсхТабл.ВывестиСекцию("ШапкаТаблицы");
	КонПовт = НачПовт + ИсхТабл.ВысотаСекции("ШапкаТаблицы");
	ИсхТабл.ПовторятьПриПечатиСтроки(НачПовт + 1, КонПовт);
	
	// выводим табличную часть
	НомСтроки = 0;
	ВыбратьСтроки();
	
	Пока ПолучитьСтроку() = 1 Цикл
		НомСтроки = НомСтроки + 1;
		ИсхТабл.ВывестиСекцию("Строка");
	КонецЦикла;
		
	// секция Итого
	ИсхТабл.ВывестиСекцию("Итого");
	
	// секция Подписи
	ИсхТабл.ВывестиСекцию("Подписи");

	ИсхТабл.Опции(0,0,0,0,ПарСтрДок,ПарСтрДок);
	ИсхТабл.ТолькоПросмотр(1);
	ИсхТабл.Показать("Печать счета","");
	
	Если СразуНаПринтер = 0 Тогда
		ИсхТабл.Опции(0,0,0,0,ПарСтрДок);

		Если глПолучитьПолномочие("РазрешитьРедактированиеТаблиц") = 0 Тогда
			ИсхТабл.Защита(1);
		Иначе
			ИсхТабл.Защита(0);
		КонецЕсли;
		ИсхТабл.ТолькоПросмотр(1);

		ИсхТабл.Показать(глНазваниеДокументаВжурнале(Контекст),"");  
	Иначе     
		ИсхТабл.ПараметрыСтраницы(,,,,,,,,,1,,);
		ИсхТабл.КоличествоЭкземпляров(КолЭкз);
		ИсхТабл.Напечатать(0);
	КонецЕсли; 
КонецПроцедуры

//******************************************************************************
// ПоКнопкеПечать()
// 
// Параметры: 
//	Нет
//
// Описание:
// 	Вызывается по кнопке "Печать"  
//
Процедура ПоКнопкеПечать(СразуНаПринтер = 0,КолЭкз = 1)
	
	// проверим полномочия печати непроведенных документов
	Если Проведен() = 0 Тогда
		Если глПолучитьПолномочие("РазрешитьПечатьНепроведенныхДокументов") = 0 Тогда
			Предупреждение("Недостаточно полномочий для печати непроведенного документа!", 60);
			Возврат;
		КонецЕсли;
	КонецЕсли;

	Если  ПустоеЗначение(НомерТекущейФормы) = 1  Тогда
		НомерТекущейФормы = 1;
		Форма.кнПечать.Заголовок(ТаблицаПечФорм.ПолучитьЗначение(НомерТекущейФормы, "Кнопка"));
	КонецЕсли;
	
	Если НомерТекущейФормы = 1  Тогда
		Печать(СразуНаПринтер, КолЭкз);
	Иначе
		Параметры = СоздатьОбъект("СписокЗначений");
		Параметры.ДобавитьЗначение(глВзятьКонтекст(Контекст), "Контекст");
		Параметры.ДобавитьЗначение(СразуНаПринтер, "Устройство");
		Параметры.ДобавитьЗначение(КолЭкз, "КоличествоКопий");
		
		ОткрытьФорму("Отчет", Параметры, глКаталогПечФорм+ТаблицаПечФорм.ПолучитьЗначение(НомерТекущейФормы,"Файл"));
	КонецЕсли;
	
КонецПроцедуры // ПоКнопкеПечать()

//******************************************************************************
// ПоКнопкеВыборПечатнойФормы()
//
// Параметры:
//  нет.    
//
// Возвращаемое значение:
//  нет.
//
// Описание:
//  - открывает список для выбора способа печати. 
//  - формирует таблицу по выбранному способу.
//
Процедура ПоКнопкеВыборПечатнойФормы()
	
    ВыбНомер = глВыборПечатнойФормы("Документ." + Вид(), ТаблицаПечФорм);
	Если ВыбНомер > 0 Тогда
		НомерТекущейФормы = ВыбНомер;
		Форма.кнПечать.Заголовок(ТаблицаПечФорм.ПолучитьЗначение(НомерТекущейФормы, "Кнопка"));
		ПоКнопкеПечать();
	КонецЕсли;

КонецПроцедуры // ПоКнопкеВыборПечатнойФормы()


Процедура ВыборГруппочки()
	спр	= создатьобъект("справочник.Номенклатура"); 
	спр.ВыборГруппы(1);     
	спр.выбрать("выберите группу товара, добавляемую к списку",); 
   //Сообщить(спр.текущийЭлемент().наименование);
	спр2	= СоздатьОбъект("Справочник.Номенклатура");
	спр2.ИспользоватьРодителя(спр.текущийЭлемент());
	спр2.ВыбратьЭлементы();
//**************************************************************
	пока спр2.получитьЭлемент()=1 Цикл
		Состояние("Обрабатываем элемент: "+спр2.Наименование);
		если (спр2.этогруппа()=0) и (спр2.ПометкаУдаления()=0) Тогда
			НоваяСтрока();
			Номенклатура	= спр2.текущийЭлемент();
			Единица			= спр2.БазоваяЕдиница;
			Артикул			= спр2.артикул;
			Производитель	= спр2.производитель;
			Коэффициент		= 1;    
			//******************************************************************************
			цен=создатьобъект("Справочник.Цены");
			Цен.ИспользоватьВладельца(Номенклатура);	//Задали, по какому элементу будем играть
			ФлагИсх=0;ФлагКон=0;	//Изучаем наличие таких типов цен
			Цен.ВыбратьЭлементы();
			Пока Цен.получитьЭлемент()=1 цикл
				если Цен.ТипЦен = ТипЦены тогда
					ЦенаСтар	= Цен.Цена.Получить(ДатаДок);
					ОбщВалюта	= Цен.валюта;
					ФлагИсх		= 1;
					продолжить;
				КонецЕсли;
			конецЦикла;
			Если ФлагИсх=0 тогда
				ЦенаСтарОбщ		= 0;
			КонецЕсли;
			//******************************************************************************
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

Процедура Наценка()
	нац	= 0;
	ВвестиЧисло(нац,"Введите наценку/уценку(-) на товар",14,2,150);
	
	если нац=0 Тогда
		Сообщить("Вы не указали наценку на товар, выполнение процедуры приостановлено...");
		Возврат;
	КонецЕсли;
	
	ВыбратьСтроки();
	Пока ПолучитьСтроку()=1 Цикл
		Состояние("Текущая позиция: "+Номенклатура.текущийЭлемент());
		Если нац>0 Тогда
			ЦенаНов	= ЦенаСтар + (ЦенаСтар/100*нац);
		Иначе
			ЦенаНов	= ЦенаСтар - (ЦенаСтар/100*нац*(-1));
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

Функция найтиТакойЖе(элем)
	перем Рез;
	если ТЗ_товара.НайтиЗначение(элем,,"Номенклатура")=0 Тогда
		рез	= 0;
	Иначе
		рез	= 1;
	КонецЕсли;
	
	Возврат рез;
КонецФункции

//*** ТУТ ВСЕ ПУСТЫЕ ВАЛЮТЫ БУДУТ ВЫТАЩЕНЫ
Процедура ВнесиПустыеВалюты()
	если ПустоеЗначение(ТипЦены)=1 тогда
		Сообщить("Выберите розничный тип цен");
		Возврат;
	КонецЕсли;
	если КоличествоСтрок()>0 Тогда
		если вопрос("Продолжить?",4,10)=6 Тогда
			УдалитьСтроки();	
		Иначе
			Возврат;
		КонецЕсли;
	КонецЕсли;

	спр	= СоздатьОбъект("Справочник.Номенклатура");
	спр.ВыбратьЭлементы(0);
	цен	= СоздатьОбъект("Справочник.Цены");
	Пока спр.ПолучитьЭлемент() = 1 Цикл
		цен.ИспользоватьВладельца(спр.ТекущийЭлемент());
		Состояние("Обрабатываем позицию: "+сокрЛП(спр.ТекущийЭлемент()));
		цен.ВыбратьЭлементы();
		Пока цен.ПолучитьЭлемент() = 1 Цикл
			если цен.ТипЦен=ТипЦены Тогда
				если пустоеЗначение(Цен.Валюта)=1 Тогда	//Выводим в список
					НоваяСтрока();
					Номенклатура	= спр.ТекущийЭлемент();
					Артикул			= Номенклатура.артикул;
					Производитель	= Номенклатура.производитель;
					Единица			= Номенклатура.БазоваяЕдиница;
					Коэффициент		= 1;
					ЦенаСтар		= Цен.Цена.Получить(ДатаДок);
					ЦенаНов			= ЦенаСтар;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
КонецПроцедуры

Процедура ПроставьВалюты()
	ВыбратьСтроки();
	Пока ПолучитьСтроку()=1 Цикл
		ОбщВалюта=глРубли;
	КонецЦикла;
КонецПроцедуры


ТипЦены		= глПользователь.ОсновнойТипЦенПродажи;
ТЗ_товара	= СоздатьОбъект("ТаблицаЗначений");
Валюта		= ТипЦены.Валюта;
////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ
//
// формируем таблицу печатных форм
НомерТекущейФормы	= 0;

ТаблицаПечФорм		= СоздатьОбъект("ТаблицаЗначений");
ТаблицаПечФорм.НоваяКолонка("Название","Строка",,,,30);
ТаблицаПечФорм.НоваяКолонка("Файл","Строка",,,"Файл",10);
ТаблицаПечФорм.НоваяКолонка("Кнопка","Строка",,,,10); 
ТаблицаПечФорм.НоваяКолонка("ФайлОписания","Строка");

ТаблицаПечФорм.НоваяСтрока();
ТаблицаПечФорм.Название     = "Печатная форма";
ТаблицаПечФорм.Кнопка       = "Печать";
