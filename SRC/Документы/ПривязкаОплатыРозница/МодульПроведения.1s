// ********************
//
Процедура ОбработкаПроведения()
	
	//******************************************************************************
	//			ВЗАИМОРАСЧЁТЫ С КЛИЕНТОМ РОЗНИЧНОГО ПОДРАЗДЕЛЕНИЯ
	//******************************************************************************
	АналитикаСчетБезналОснования = "";
	//Если итог("Сумма")>0 Тогда	//Уберем из копилки   
	Если ДокОснование.Выбран() = 1 Тогда
		Если ДокОснование.Вид() = "СчетБнРозница" Тогда
			АналитикаСчетБезналОснования = ДокОснование.АналитикаСчетБезналПроценты;
			СкладОснования = ДокОснование.Склад;
			
			Если ПустоеЗначение(АналитикаСчетБезналОснования) = 1 Тогда
				АналитикаСчетБезналОснования = глПолучитьАналитику(Контекст, "АналитикаСчетБезналПроценты")
			КонецЕсли;
		ИначеЕсли ДокОснование.Вид() = "Реализация" Тогда 
			Если ДокОснование.ДокОснование.Вид() = "РасходнаяНакладнаяРозницаБезнал" Тогда 
				АналитикаСчетБезналОснования = ДокОснование.АналитикаСчетБезналПроценты;
				СкладОснования = ДокОснование.Склад;
				
				Если ПустоеЗначение(АналитикаСчетБезналОснования) = 1 Тогда
					АналитикаСчетБезналОснования = глПолучитьАналитику(Контекст, "АналитикаСчетБезналПроценты")
				КонецЕсли;		
			КонецЕсли;	
		ИначеЕсли ДокОснование.Вид() = "РасходнаяНакладнаяРозницаБезнал" Тогда 
			АналитикаСчетБезналОснования = ДокОснование.АналитикаСчетБезналПроценты;
			СкладОснования = ДокОснование.Склад;
			
			Если ПустоеЗначение(АналитикаСчетБезналОснования) = 1 Тогда
				АналитикаСчетБезналОснования = глПолучитьАналитику(Контекст, "АналитикаСчетБезналПроценты")
			КонецЕсли;		
		КонецЕсли;     
	КонецЕсли;
	
	  
	ТекЗаявка = глПолучитьЗаявкуПривязка(Контекст);
	Если ПустоеЗначение(ТекЗаявка) = 0 Тогда
		Регистр.ПривязкаОплаты.ДокументРасчета 		= ТекЗаявка;
		Регистр.ПривязкаОплаты.Сумма 	   			= Итог("Сумма");
		Регистр.ПривязкаОплаты.ДвижениеВыполнить();   
	КонецЕсли;
	

	ВыбратьСтроки();
	Пока ПолучитьСтроку()=1 Цикл
		Регистр.Покупатели_Розница.Контрагент				= Контрагент;
		Регистр.Покупатели_розница.ВидВзаимодействия		= Перечисление.ВидВзаимодействия.Оплата;
		Регистр.Покупатели_Розница.Магазин					= Склад;
		Регистр.Покупатели_Розница.КредДокумент				= Документ_;
		Регистр.Покупатели_Розница.СуммаРуб					= Сумма;
		Регистр.Покупатели_розница.АналитикаПродажи 		= АналитикаПродажи;
		Регистр.Покупатели_розница.АналитикаСчетБезнал 		= АналитикаСчетБезнал;
		Регистр.Покупатели_Розница.ДвижениеПриходВыполнить();     
		//
		//Регистр.Покупатели_Розница.Контрагент			= Контрагент;
		//Регистр.Покупатели_розница.ВидВзаимодействия	= Перечисление.ВидВзаимодействия.Оплата;
		//Регистр.Покупатели_Розница.Магазин				= СкладОснования;
		//Регистр.Покупатели_Розница.КредДокумент			= "";
		//Регистр.Покупатели_Розница.СуммаРуб				= Сумма;
		//Регистр.Покупатели_розница.АналитикаПродажи 	= "";
		//Регистр.Покупатели_розница.АналитикаСчетБезнал 	= АналитикаСчетБезналОснования;
		//Регистр.Покупатели_Розница.ДвижениеРасходВыполнить();   
		
		Если СуммаПоОплате <> 0 Тогда 
			Регистр.ПереносОплаты.Контрагент 					= Контрагент;
			Регистр.ПереносОплаты.СчетБезнал		 			= АналитикаСчетБезнал;
			Регистр.ПереносОплаты.СуммаОплаты 		 			= СуммаПоОплате;
			Регистр.ПереносОплаты.ДвижениеПриходВыполнить();
			
			Регистр.ПереносОплаты.Контрагент 					= Контрагент;
			Регистр.ПереносОплаты.СчетБезнал		 			= АналитикаСчетБезналОснования;
			Регистр.ПереносОплаты.СуммаОплаты 		 			= СуммаПоОплате;
			Регистр.ПереносОплаты.ДвижениеРасходВыполнить();        
		КонецЕсли;
		
		Если СуммаПоОтгрузке <> 0 Тогда
			Регистр.ПереносОплаты.Контрагент 					= Контрагент;
			Регистр.ПереносОплаты.СчетБезнал		 			= АналитикаСчетБезнал;
			Регистр.ПереносОплаты.СуммаОтгрузки		 			= СуммаПоОтгрузке;
			Регистр.ПереносОплаты.ДвижениеРасходВыполнить(); 
			
			Регистр.ПереносОплаты.Контрагент 					= Контрагент;
			Регистр.ПереносОплаты.СчетБезнал		 			= АналитикаСчетБезналОснования;
			Регистр.ПереносОплаты.СуммаОтгрузки		 			= СуммаПоОтгрузке;
			Регистр.ПереносОплаты.ДвижениеПриходВыполнить(); 
		КонецЕсли;
	КонецЦикла;
	//КонецЕсли;
	
	
КонецПроцедуры //ОбработкаПроведения()

Процедура ОбработкаУдаленияПроведения()
	Если НазваниеНабораПрав()="Продавец_розница" Тогда
		Сообщить("Вы не можете отменять проведение данного документа");
		СтатусВозврата(0);
		Возврат;
	КонецЕсли;
КонецПроцедуры
