// ********************
//
Процедура ОбработкаПроведения()

	Если ПустоеЗначение(ДатаНачалаАкции) = 1 Тогда
		глНеПроводить(Контекст,"Не заполнена дата начала акции.");
		Возврат;
	КонецЕсли;
	
	Если ПустоеЗначение(ДатаОкончанияАкции) = 1 Тогда
		глНеПроводить(Контекст,"е заполнена дата окончания акции.");
		Возврат;
	КонецЕсли;
	
	Если ДатаНачалаАкции > ДатаОкончанияАкции Тогда
		глНеПроводить(Контекст,"Дата начала акции не должна быть больше даты окончания.");
		Возврат;
	КонецЕсли;
	
	ВыбратьСтроки();
	Пока ПолучитьСтроку() = 1 Цикл
		ИсторияИзмененияПроцент = СоздатьОбъект("Периодический");
		ИсторияИзмененияПроцент.ИспользоватьОбъект("ПроцентПоАкции", Номенклатура.ТекущийЭлемент());
		ЗначениеДоАкции = ИсторияИзмененияПроцент.ЗначениеНаДату(ДатаНачалаАкции - 1);
		Если Процент <> 0 Тогда
			ИсторияИзмененияПроцент.Значение = Процент;
            ИсторияИзмененияПроцент.ДатаЗнач = ДатаНачалаАкции;
            ИсторияИзмененияПроцент.Записать(); 
			
			ИсторияИзмененияПроцент.Значение = ЗначениеДоАкции;
            ИсторияИзмененияПроцент.ДатаЗнач = ДатаОкончанияАкции + 1;
            ИсторияИзмененияПроцент.Записать();
			//Номенклатура.ПроцентПоАкции.Установить(ДатаНачалаАкции, Процент);
			//Номенклатура.ПроцентПоАкции.Установить(ДатаОкончанияАкции + 1, ЗначениеДоАкции);
		КонецЕсли;
	КонецЦикла;

КонецПроцедуры

//======================================================================
Процедура ОбработкаУдаленияПроведения()
	ВыбратьСтроки();
	Пока ПолучитьСтроку() = 1 Цикл
		ИсторияИзмененияПроцент = СоздатьОбъект("Периодический");
		ИсторияИзмененияПроцент.ИспользоватьОбъект("ПроцентПоАкции", Номенклатура.ТекущийЭлемент());
		ИсторияИзмененияПроцент.ВыбратьЗначения();
		Пока ИсторияИзмененияПроцент.получитьЗначение()=1 Цикл
			Если (ИсторияИзмененияПроцент.ДатаЗнач = ДатаНачалаАкции)
			или  (ИсторияИзмененияПроцент.ДатаЗнач = ДатаОкончанияАкции + 1) Тогда
				ИсторияИзмененияПроцент.Удалить();
			КонецЕсли;
		КонецЦикла;	
	КонецЦикла;
КонецПроцедуры // ОбработкаУдаленияПроведения
