Перем ОбщРег, ОстаткиТМЦ, РезервыТМЦ, СписокПараметров; // для показа остатков


Процедура ПриОткрытии()
	ПриЗаписиПерепроводить(1);
КонецПроцедуры
     
Процедура ПриЗаписи()
	ПриЗаписиДокумента(Контекст);
КонецПроцедуры	

//******************************************************************************
// Предопределенная процедура
//
Процедура ВводНаОсновании(ДокументОснование)
	
		Перем ОстатокНаСкладе, ОстатокПоФирме , Резерв , ТовСкидка; // для показа остатков

	СинонимДокумента	= ПредставлениеВида();
	СинонимОснования	= ДокументОснование.ПредставлениеВида();
	
	Список	= глПолучитьСписокВводимыхНаОсновании(ДокументОснование);
	Поз		= Список.НайтиЗначение(Вид());
	                                                   
	Склад = ДокументОснование.Склад;
	
	// выполним проверку, можно ли вводить документ на основании ДокументОснование
	Если Поз = 0 Тогда
		// ДокументОснование не найден в списке разрешенных
		Предупреждение("Документ """ + СинонимДокумента +
		                """ нельзя вводить на основании """ + СинонимОснования + """", 60);
		СтатусВозврата(0);
		Возврат;
	КонецЕсли;
	
	КодОперации	= Перечисление.КодыОпераций.Продажа;
	глЗаполнитьШапкуНаОсн(Контекст,ДокументОснование);
	
	
	// По умолчанию выписываем в той же валюте и по тому же курсу, что и документ-основание
	Валюта = ДокументОснование.Валюта;
	Курс   = ДокументОснование.Курс;
	
	ДокументОснование.ВыбратьСтроки();
	Пока ДокументОснование.ПолучитьСтроку() = 1 Цикл
	                   
		Если глПересчетРегистров(Контекст, СписокПараметров, "БезРасчетаРегистров") = 1 Тогда

		глПолучитьОстаткиНоменклатуры(глФирмаДляОстатковТМЦ(ДокументОснование.Фирма), ДокументОснование.Номенклатура, ДокументОснование.Единица,ОстаткиТМЦ , ОстатокНаСкладе, ОстатокПоФирме, ДокументОснование.Склад, , 1,,ДокументОснование,Резерв);
    КонецЕсли;
	
		
	КонецЦикла;
	

		
КонецПроцедуры // ВводНаОсновании()
СписокПараметров = СоздатьОбъект("СписокЗначений"); 
СписокПараметров.Установить("ОбщРег"              , ОбщРег);
СписокПараметров.Установить("ОстаткиТМЦ"          , ОстаткиТМЦ);
СписокПараметров.Установить("РезервыТМЦ"          , РезервыТМЦ);
СписокПараметров.Установить("ФильтрПоСкладу"      , ПолучитьПустоеЗначение("Справочник.Склады"));
СписокПараметров.Установить("ФильтрПоФирме"       , ПолучитьПустоеЗначение("Справочник.Фирмы"));
СписокПараметров.Установить("ПозицияРегистра"     , 0); 
ОбщРег           = СоздатьОбъект("Регистры");
ОстаткиТМЦ       = ОбщРег.ОстаткиТМЦ;
РезервыТМЦ       = ОбщРег.РезервыТМЦ;
