Процедура Вверх()
	х=вариантЗаполнения.ТекущаяСтрока();
	Если х>1 Тогда
		вариантЗаполнения.СдвинутьЗначение(-1);
	КонецЕсли;
КонецПроцедуры
Процедура Вниз()
	х=вариантЗаполнения.ТекущаяСтрока();
	Если х<3 Тогда
		вариантЗаполнения.СдвинутьЗначение(1);
	КонецЕсли;
КонецПроцедуры



Процедура Сформировать()
	Перем Запрос, ТекстЗапроса, Таб;
	//Создание объекта типа Запрос
	Запрос = СоздатьОбъект("Запрос");
	ТекстЗапроса = 
	"//{{ЗАПРОС(Сформировать)
	|Период с ВыбНачПериода по ВыбКонПериода;
	|Контрагент = Регистр.Покупатели_розница.Контрагент;
	|ВидВзаимодействия = Регистр.Покупатели_розница.ВидВзаимодействия;
	|Магазин = Регистр.Покупатели_розница.Магазин;
	|КредДокумент = Регистр.Покупатели_розница.КредДокумент;
	|СуммаРуб = Регистр.Покупатели_розница.СуммаРуб;
	|Функция СуммаРубНачОст = НачОст(СуммаРуб);
	|Функция СуммаРубПриход = Приход(СуммаРуб);
	|Функция СуммаРубРасход = Расход(СуммаРуб);
	|Функция СуммаРубКонОст = КонОст(СуммаРуб);"
	;
	
	
	//Начинаем формировать группировки, в зависимости от выбора пользователя
	х = 0;
	Для х = 1 По 4 Цикл
		Если вариантЗаполнения.Пометка(х)=1 Тогда
			ТекстЗапроса=ТекстЗапроса+"Группировка "+вариантЗаполнения.ПолучитьЗначение(х)+" без Групп;";
		КонецЕсли;
	КонецЦикла;	
	
	ВыбМагазин=СоздатьОбъект("СписокЗначений");
	х = 0;
	Для х = 1 По списокМагазинов.РазмерСписка() Цикл
		Если списокМагазинов.Пометка(х)=1 Тогда
			ВыбМагазин.ДобавитьЗначение(списокМагазинов.ПолучитьЗначение(х));
		КонецЕсли;
	КонецЦикла;	

	ТекстЗапроса=ТекстЗапроса+
	"Условие(Контрагент в ВыбКонтрагент);
    |Условие(ВидВзаимодействия в ВыбВидВзаимодействияРозница);
	|Условие(Магазин в ВыбМагазин);
	|"//}}ЗАПРОС
	;
    
	// Если ошибка в запросе, то выход из процедуры
	Если Запрос.Выполнить(ТекстЗапроса) = 0 Тогда
		Возврат;
	КонецЕсли;
    
	//ТЗ=СоздатьОбъект("ТаблицаЗначений");
	//Запрос.Выгрузить(ТЗ,0,0);
	//ТЗ.ВыбратьСтроку();
	// Подготовка к заполнению выходных форм данными запроса
	Таб = СоздатьОбъект("Таблица");
	Таб.ИсходнаяТаблица("Сформировать");
	// Заполнение полей "Заголовок"
	Таб.ВывестиСекцию("Заголовок");
	Состояние("Заполнение выходной таблицы...");
	Таб.Опции(0, 0, Таб.ВысотаТаблицы(), 0);
	Пока Запрос.Группировка(1) = 1 Цикл
		// Заполнение полей Контрагент
		Таб.ВывестиСекцию("Контрагент");
		Пока Запрос.Группировка(2) = 1 Цикл
			// Заполнение полей ВидВзаимодействия
			Таб.ВывестиСекцию("ВидВзаимодействия");
			Пока Запрос.Группировка(3) = 1 Цикл
				// Заполнение полей Магазин
				Таб.ВывестиСекцию("Магазин");
				Пока Запрос.Группировка(4) = 1 Цикл
					// Заполнение полей КредДокумент
					Таб.ВывестиСекцию("КредДокумент");
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
	// Заполнение полей "Итого"
	Таб.ВывестиСекцию("Итого");
	// Вывод заполненной формы
	Таб.ТолькоПросмотр(1);
	Таб.Показать("Сформировать", "");
	
КонецПроцедуры

Процедура ВнестиКонтрагента()
	ОткрытьПодбор("Справочник.Контрагенты","ФормаДляВыбораРозница",Контекст,1);
КонецПроцедуры 

Процедура ОбработкаПодбора(Элемент, КонтФормы)
	Если Элемент.ЭтоГруппа()=0 Тогда
		Если ВыбКонтрагент.НайтиЗначение(Элемент.ТекущийЭлемент())=0 Тогда
			ВыбКонтрагент.ДобавитьЗначение(Элемент.ТекущийЭлемент());
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры // ОбработкаПодбора()
//******************************************************************************
//			Операторы основной программы			

вариантЗаполнения.УдалитьВсе();
вариантЗаполнения.ДобавитьЗначение("Контрагент");
вариантЗаполнения.ДобавитьЗначение("Магазин");
вариантЗаполнения.ДобавитьЗначение("ВидВзаимодействия","Вид взаимодействия");
вариантЗаполнения.ДобавитьЗначение("КредДокумент");

списокМагазинов.УдалитьВсе();
сп=СоздатьОбъект("Справочник.Склады");
сп.ВыбратьЭлементы();
Пока сп.ПолучитьЭлемент()=1 Цикл
    Если сп.Магазин=1 Тогда
        списокМагазинов.ДобавитьЗначение(сп.ТекущийЭлемент());
    КонецЕсли;
КонецЦикла;

ВыбКонтрагент.УдалитьВсе();
