//*******************************************
// Процедура генерации запроса Сформировать.
//
Процедура Сформировать()
	Перем Запрос, ТекстЗапроса, Таб;
	//Создание объекта типа Запрос
	Запрос = СоздатьОбъект("Запрос");
	ТекстЗапроса = 
	"//{{ЗАПРОС(Сформировать)
	|Период с ВыбНачПериода по ВыбКонПериода;
	|ТекущийДокумент = Документ.РКО.ТекущийДокумент, Документ.ПКО.ТекущийДокумент;
	|Подотчетник = Документ.РКО.Подотчетник, Документ.ПКО.Подотчетник;
	|Подчинение1 = Документ.РКО.Подчинение1,Документ.ПКО.Подчинение1;
	|СписокСтатейДР = Документ.РКО.СписокСтатейДР,Документ.ПКО.СписокСтатейДР;
	|СуммаПлюс = Документ.РКО.Сумма;
	|СуммаМинус = Документ.ПКО.Сумма;
	|Валюта = Документ.РКО.Валюта,Документ.ПКО.Валюта;
	|Прочее = Документ.РКО.Прочее,Документ.ПКО.Прочее;
	|Функция СуммаСуммаПлюс = Сумма(СуммаПлюс);
	|Функция СуммаСуммаМинус = Сумма(СуммаМинус);
	|Группировка Подчинение1 без групп;
	|Группировка ТекущийДокумент без групп;
	|Условие(Подотчетник = 1);
	|Условие(Подчинение1 в ВыбПодчинение1);
	|"//}}ЗАПРОС
	;
	// Если ошибка в запросе, то выход из процедуры
	Если Запрос.Выполнить(ТекстЗапроса) = 0 Тогда
		Возврат;
	КонецЕсли;

	// Подготовка к заполнению выходных форм данными запроса
	Таб = СоздатьОбъект("Таблица");
	Таб.ИсходнаяТаблица("Сформировать");
	// Заполнение полей "Заголовок"
	Таб.ВывестиСекцию("Заголовок");
	Состояние("Заполнение выходной таблицы...");
	Таб.Опции(0, 0, Таб.ВысотаТаблицы(), 0);
	Пока Запрос.Группировка(1) = 1 Цикл
		// Заполнение полей Подчинение1
		Таб.ВывестиСекцию("Подчинение1");
		Пока Запрос.Группировка(2) = 1 Цикл
			док=Запрос.ТекущийДокумент;
			Таб.ВывестиСекцию("ТекущийДокумент");
		КонецЦикла;
	КонецЦикла;
	// Заполнение полей "Итого"
	//По идее правильно было сделать через запрос - но БЛЯ заебало - как проще, так и делаю
	ТЗ=СоздатьОбъект("ТаблицаЗначений");
	Запрос.Выгрузить(ТЗ,0,0);
	
	ТЗ.ВыбратьСтроки();
	ТЗ.НоваяКолонка("Валюта","Справочник.Валюты");
	Пока ТЗ.ПолучитьСтроку() = 1 Цикл
		тз.Валюта	= тз.ТекущийДокумент.Валюта;
	КонецЦикла;
	ТЗ.Свернуть("Валюта","СуммаСуммаПлюс,СуммаСуммаМинус");
	
	тз.ВыбратьСтроки();
	Пока тз.ПолучитьСтроку() = 1 Цикл
		Таб.ВывестиСекцию("Итого");
	КонецЦикла;
	// Вывод заполненной формы
	Таб.ТолькоПросмотр(1);
	Таб.Показать("Сформировать", "");
КонецПроцедуры




